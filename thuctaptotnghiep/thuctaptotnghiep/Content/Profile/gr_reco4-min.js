(function(){var TrimPath;var multiline;var grJSON3;var privatescope={};var module=undefined;var define=undefined;window.undefined=window.undefined;var GravityRD={config:{},apply:function(obj,conf,overwrite){if(obj&&conf&&typeof conf=="object"){for(var k in conf){if(overwrite===undefined||overwrite===true){obj[k]=conf[k]}else{if(obj[k]===undefined){obj[k]=conf[k]}}}}return obj},override:function(origclass,override){GravityRD.apply(origclass.prototype,override)},extend:function(sp,overrides){var sb=overrides.constructor!=Object.prototype.constructor?overrides.constructor:function(){sp.apply(this,arguments)};var F=function(){},sbp,spp=sp.prototype;F.prototype=spp;sbp=sb.prototype=new F();sbp.constructor=sb;sb.superclass=spp;if(spp.constructor==Object.prototype.constructor){spp.constructor=sp}sb.override=function(o){GravityRD.override(sb,o)};sbp.superclass=(function(){return spp});sbp.override=function(o){for(var m in o){this[m]=o[m]}};GravityRD.override(sb,overrides);sb.extend=function(o){return GravityRD.extend(sb,o)};if(overrides.__public__!=undefined||spp.__public__!=undefined){var _public=[];if(overrides.__public__!=undefined){var remove={};for(var i=0;i<overrides.__public__.length;i++){name=overrides.__public__[i];if(name.charAt(0)==="-"){name=name.substring(1);remove[name]=true}else{_public.push(name);remove[name]=true}}if(spp.__public__!=undefined){for(var i=0;i<spp.__public__.length;i++){name=spp.__public__[i];if(!remove[name]){_public.push(name)}}}}else{_public=spp.__public__}sbp.__public__=_public}return sb},bind:function(func,scope){return function(){return func.apply(scope,arguments)}},namespace:function(ns){var domains=ns.split(".");var p=eval(domains[0])||{};for(var i=1;i<domains.length;i++){p[domains[i]]=p[domains[i]]||{};p=p[domains[i]]}return p},register:function(ns,name,module){ns=this.namespace(ns);if(typeof(module.__interface__)=="function"){ns[name]=module.__interface__()}else{ns[name]=module}},isObject:function(o){if(o==null){return false}return Object.prototype.toString.apply(o)==="[object Object]"},isArray:function(o){if(o==null){return false}return Object.prototype.toString.apply(o)==="[object Array]"},isFunction:function(o){if(o==null){return false}return typeof(o)==="function"},isString:function(o){return typeof(o)==="string"},isNull:function(o){return o===null},isUndefined:function(o){return o===undefined},each:function(input,fn,scope){if(!input){return}if(!this.isString(input)&&typeof input.length=="number"){for(var i=0;i<input.length;i++){fn.call(scope||this,input[i],i)}}else{fn.call(scope||this,input)}},map:function(obj,iterator,scope){var results=[];if(obj==null){return results}this.each(obj,function(value,index,list){results[results.length]=iterator.call(scope,value,index,list)});return results},obj:function(list,values){if(list==null){return{}}var result={};for(var i=0,l=list.length;i<l;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result},keys:function(object){var ret=[];for(k in object){if(object.hasOwnProperty(k)){ret.push(k)}}return ret},hash:function(nv){var na=GravityRD.keys(nv);na.sort(function(a,b){return a<b?-1:(a>b?+1:0)});var input="";for(var i=0;i<na.length;i++){var val=nv[na[i]];input+=na[i]+":"+(GravityRD.isArray(val)?val.join(","):val)+";"}hash=(function(e){for(var r=0,i=0;i<e.length;i++){r=(r<<5)-r+e.charCodeAt(i),r&=r}return r})(input);return hash},init:function(conf,buildSHA){GravityRD.Typecheck.argumentChecker("GravityRD.init",arguments).notNull(0).notUndefined(0).isObject(0);conf.buildSHA=buildSHA;GravityRD.Core.setServer(conf)},start:function(){GravityRD.Log.timeStamp("GR:start()");if(GravityRD.Worker.start()){if(GravityRD.Core.getConfig()["mode"]==="DEVELOP"){GravityRD.Log.info("Develop mode enabled. Please don't forget to turn it off.")}if(GravityRD.Core.debug("api")){window.GR=this;window.GR.sd=function(){console.log("click",unescape(window.localStorage.getItem("gr_click")));console.log("click_ts",unescape(window.localStorage.getItem("gr_click_ts")));console.log("recmap",unescape(window.localStorage.getItem("gr_recmap")));console.log("recmap_ts",unescape(window.localStorage.getItem("gr_recmap_ts")));console.log("recmapkeys",unescape(window.localStorage.getItem("gr_recmapkeys")));console.log("recmapkeys_ts",unescape(window.localStorage.getItem("gr_recmapkeys_ts")));console.log("event",unescape(window.localStorage.getItem("gr_event")));console.log("track",unescape(window.localStorage.getItem("gr_track")));console.log("cart",unescape(window.localStorage.getItem("gr_cart")))};window.GR.sr=function(){window.localStorage.removeItem("gr_click");window.localStorage.removeItem("gr_click_ts");window.localStorage.removeItem("gr_recmap");window.localStorage.removeItem("gr_recmap_ts");window.localStorage.removeItem("gr_recmapkeys");window.localStorage.removeItem("gr_recmapkeys_ts");window.localStorage.removeItem("gr_event");window.localStorage.removeItem("gr_track");window.localStorage.removeItem("gr_cart");return window.localStorage}}window.GravityRD={validationError:function(o){GravityRD.Log.validationError(o)},setGeneratedCookie:function(cid){GravityRD.Core.Cookie.setGeneratedCookie(cid)},responseCallback:function(result){GravityRD.Core.useResultCB(result)},searchCallback:function(name,data){if(GravityRD.Search!=undefined){GravityRD.Search.callback(name,data)}},multiline:function(){return multiline.apply(this,arguments)}}}}};GravityRD.Base=GravityRD.extend(Object,{__public__:[],__interface__:function(){var _private=this;var ret={};for(var idx=0;idx<this.__public__.length;idx++){var name=this.__public__[idx];ret[name]=(function(name){return function(){return _private[name].apply(_private,arguments)}})(name)}return ret}});GravityRD.Exc=GravityRD.extend(Object,{APIUSAGE:1,VALIDATION:2,constructor:function(type,msg){this.type=type;this.msg=msg},toString:function(){return this.msg}});(function(){var javascriptEscape=function(s){return String(s).replace(/\\/g,"\\\\").replace(/\0/g,"\\x00").replace(/"/g,"\\x22").replace(/'/g,"\\x27").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/&/g,"\\x26").replace(/</g,"\\x3c").replace(/>/g,"\\x3e").replace(/-/g,"\\x2d")};var modifiers={html:function(s){return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},javascript:javascriptEscape,js:javascriptEscape,truncate:function(s,l,d){var ret=s;if(s.length>l){ret=s.substring(0,l)+d}return ret}};var GravityRD_Core=GravityRD.Base.extend({__public__:["process","set","setServer","useResultCB","errorCB","saveParams","addListener","getConfig","getRequestNumber","setRecId","debug","debugMask","setGlobalNameValue","addGlobalNameValue","getGlobalNameValue","search","onUsageError"],serverConfigDefault:{disabled:false,buildSHA:"notset",targetServer:"saas.gravityrd.com",retargetingTrack:false,retargetingServer:"api.worldgravity.com",partnerId:null,mode:"PROD",debug:{api:true,perf:true,tracking:true,postrender:true,log:true,hud:true,routing:true,callback:true},trackEvents:false,trackEventsMaxSize:20,trackEventsFilter:{VIEW:[]},trackCart:false,trackPageLeaveEvent:false,trackReferrer:false,trackLocation:false,trackSession:false,trackPage:false,sessionStorage:true,logExceptions:true,enableRegisterRecId:false,cookiePath:"/",cookieDomain:null,addRandomSeed:false,randomSeedExpire:10,deferEvents:true,deferEventsTime:15000,recClickExpire:0,recClickTrackMax:10,nullStrings:["null","NULL","nil","0"],wrongNameValues:["userId","cookieId"],allowOverride:["mode","sessionStorage"],customConfig:"enabled",customConfigDemoKey:"F8",routingGlobal:{useUser:false},forceProtocol:false,persistUserId:false,nameValueMaxSize:1024},serverConfig:null,globalConfig:{userId:null,cookieName:"gr_reco",cookieId:null,retargeting:false,useJsGeneratedCookie:true},requestNumber:0,parmsHistory:[],params:null,handle:null,firstCall:true,globalNameValues:{},listeners:[],addGlobalNameValue:function(key,val,overwrite,persist){if(key==="userId"){this.set({userId:""+val});return}if(this.globalNameValues[key]===undefined||overwrite===true){this.globalNameValues[key]=[]}else{if(!GravityRD.isArray(this.globalNameValues[key])){var tmp=this.globalNameValues[key];this.globalNameValues[key]=[];if(tmp!==undefined&&tmp!==null){this.globalNameValues[key].push(tmp)}}}GravityRD.each(val,function(item){if(item!==null&&item!==undefined){var ms=this.getConfig()["nameValueMaxSize"];var v=""+item;if(v!==undefined&&v!==null&&v.length>ms){v=v.substring(0,ms);GravityRD.Log.debug("Truncating namevalue '"+key+"', because it exceeds size limit "+ms)}this.globalNameValues[key].push(v)}},this);if(this.globalNameValues[key].length==1){this.globalNameValues[key]=this.globalNameValues[key][0]}else{if(this.globalNameValues[key].length==0){delete this.globalNameValues[key]}}GravityRD.Log.debug("Adding global nameValue '"+key+"':'"+val+"', overwrite="+overwrite+", persist="+persist,this.globalNameValues[key]);if(persist==="session"){GravityRD.Core.Cookie.addSessionNameValue(key,this.globalNameValues[key])}else{if(!!persist){GravityRD.Core.Cookie.addPersistentNameValue(key,this.globalNameValues[key])}}},setGlobalNameValue:function(key,val,persist){this.addGlobalNameValue(key,val,true,persist)},getGlobalNameValue:function(key){return this.globalNameValues[key]},addListener:function(listener){this.listeners.push(listener)},constructor:function(){this.initParams()},setServer:function(rd){if(this.serverConfig==null){this.serverConfig={};GravityRD.apply(this.serverConfig,this.serverConfigDefault);GravityRD.apply(this.serverConfig,rd);var scriptTags=document.getElementsByTagName("script");for(var k=0;k<scriptTags.length;k++){var mt=(scriptTags[k].src||"").match(/\/([^/]*)\/gr_reco.(.min)?\.js/);if(mt){var src=scriptTags[k].src;var match=src.match(/:\/\/([^/]*)/);var m=match[1].replace(/local\./,"");var kk=GravityRD.keys(rd.overlays||{});for(var i=0;i<kk.length;i++){var key=kk[i];if(m.match(new RegExp(".*"+key+".*"))){GravityRD.apply(this.serverConfig,rd.overlays[key])}}if(!rd.partnerId){this.serverConfig.partnerId=mt[1]}if(!rd.targetServer){this.serverConfig.targetServer=m}if(!rd.retargetingServer){this.serverConfig.retargetingServer=mt[1]+".worldgravity.com"}break}}}},set:function(rd){var ao=this.getConfig()["allowOverride"]||[];for(var k in rd){if(!rd.hasOwnProperty(k)){continue}if(k==="type"){continue}if(k==="mode"&&GravityRD.Core.debug("log")){this.globalConfig.mode="DEVELOP";this.serverConfig.mode="DEVELOP";continue}if(this.globalConfig[k]!==undefined){if(!GravityRD.isUndefined(rd.userId)&&rd.userId!==this.globalConfig.userId&&this.parmsHistory.length!=0){GravityRD.Log.debug("The userId has changed: emptying buffers.");this.scheduleRequest(-1);this.request()}this.globalConfig[k]=rd[k];if(k=="userId"){var persist=this.getConfig()["persistUserId"];if("session"===persist){GravityRD.Core.Cookie.addSessionNameValue(k,this.globalConfig[k])}else{if(!!persist){GravityRD.Core.Cookie.addPersistentNameValue(k,this.globalConfig[k])}}}}else{var found=false;for(var j=0;j<ao.length;j++){if(ao[j]===k){this.globalConfig[k]=rd[k];found=true;break}}if(!found){GravityRD.Log.debug("Attribute '"+k+"' treated as global nameValue");this.setGlobalNameValue(k,rd[k])}}}},getRequestNumber:function(){return this.requestNumber},addEvent:function(rd){rd.recId=rd.recommendationId||rd.recId||undefined;rd.recommendationId=undefined;if(rd.recId==undefined){var rid;if(rd.eventType==="REC_CLICK"){rid=GravityRD.Core.Cookie.getRecId(rd.itemId);if(rid!=null){GravityRD.Log.debug("Adding recId '"+rid+"' for event '"+rd.eventType+"', item '"+rd.itemId+"'");GravityRD.Core.Cookie.registerRecClickId(rd.itemId,rid);rd.recId=rid}}else{rid=GravityRD.Core.Cookie.getRecClickId(rd.itemId);if(rid!=null){GravityRD.Log.debug("Adding recClickId '"+rid+"' for event '"+rd.eventType+"', item '"+rd.itemId+"'");rd.recId=rid}}}this.addLocationAndReferrer("event",rd);GravityRD.Core.Cookie.trackEvents(rd);this.params.events.push(rd);GravityRD.each(this.listeners,function(listener){if(GravityRD.isFunction(listener.onEvent)){listener.onEvent.call(this,rd)}},this)},addLocationAndReferrer:function(type,rd){var config=GravityRD.Core.getConfig();var trackReferrer=config.trackReferrer||{};if(trackReferrer===true||trackReferrer[type]===true){if(document.referrer!=undefined&&document.referrer!=null){GravityRD.Log.debug("Adding referrer '"+document.referrer+"' for "+type,rd);rd.referrer=document.referrer}}var trackLocation=config.trackLocation||{};if(trackLocation===true||trackReferrer[type]===true){if(document.location.href!==undefined&&document.location.href!=null){GravityRD.Log.debug("Adding location '"+document.location.href+"' for "+type,rd);rd.location=document.location.href}}},addRandomSeed:function(rd){if(GravityRD.Core.getConfig()["addRandomSeed"]){rd.GravityRandomSeed=GravityRD.Core.Cookie.getRandomSeed()}},debug:function(key){var debugGlobal=this.getConfig()["debugGlobal"]||[];var debugConfig=this.getConfig()["debug"];var ret=this.debugMask[key]||debugGlobal[key]||false;if(debugConfig===true){return ret}else{return !!debugConfig[key]&&ret}},debugMask:function(mask){this.debugMask=mask},addRecommendationRequest:function(rd){this.checkTemplating(rd);if(rd.resultNames==undefined&&rd.templating!=undefined&&!rd.templating.serverSide){rd.resultNames=this.parseTemplateVariables(rd.templating.template);GravityRD.Log.debug("Autogenerating resultNames",rd.resultNames)}rd.recommendationIndex=this.params.recommendationRequests.length;if(rd.groupId!==undefined){if(rd.groupSeq==undefined){GravityRD.Log.usageError("GR-023",rd.groupId)}var index=-1;for(var i=0;i<this.params.recommendationRequests.length;i++){if(this.params.recommendationRequests[i].groupId==rd.groupId){index=i;break}}if(index==-1){if(rd.groupSize==undefined){GravityRD.Log.usageError("GR-024",rd.groupId)}if(rd.groupSize<1){GravityRD.Log.usageError("GR-026",rd.groupId,rd.groupSize)}if(rd.groupSize==1){rd.__completed=true}}else{var last=this.params.recommendationRequests[index];var size=last.groupSize;if(rd.groupSize!=undefined){if(rd.groupSize!==size){GravityRD.Log.usageError("GR-027",rd.groupId,rd.groupSize,size)}}var seq=1;while(last.__next!==undefined&&last.__next!==null){seq=seq+1;last=last.__next}if(seq+1==rd.groupSeq){last.__next=rd;if(seq+1==size){last=this.params.recommendationRequests[index];last.__completed=true;while(last.__next!==undefined&&last.__next!==null){last=last.__next;last.__completed=true}}}else{GravityRD.Log.usageError("GR-025",rd.groupId,rd.groupSeq,seq+1)}}}this.addLocationAndReferrer("recommendation",rd);this.addRandomSeed(rd);this.params.recommendationRequests.push(rd);GravityRD.each(this.listeners,function(listener){if(GravityRD.isFunction(listener.onRecommendation)){listener.onRecommendation.call(this,rd)}},this)},addExplanationRequest:function(rd){this.checkTemplating(rd);if(rd.resultNames==undefined&&rd.templating!=undefined){rd.resultNames=this.parseTemplateVariables(rd.templating.template);GravityRD.Log.debug("Autogenerating resultNames",rd.resultNames)}rd.explanationIndex=this.params.explanationRequests.length;this.addLocationAndReferrer("explanation",rd);this.addRandomSeed(rd);this.params.explanationRequests.push(rd);GravityRD.each(this.listeners,function(listener){if(GravityRD.isFunction(listener.onExplanation)){listener.onExplanation.call(this,rd)}},this)},checkTemplating:function(rd){if(rd.templating===undefined&&rd.callback===undefined){GravityRD.Log.usageError("GR-012")}if(rd.templating!==undefined){rd.templating.serverSide=false;if(rd.templating.templateElementId!=undefined){if(rd.templating.template!==undefined){GravityRD.Log.usageError("GR-013")}var element=document.getElementById(rd.templating.templateElementId);if(element!=null){rd.templating.template=element.value;if(typeof(templateContent)==="undefined"){rd.templating.template=element.innerHTML}}}else{if(rd.templating.templateId!==undefined&&rd.templating.template===undefined){GravityRD.Log.debug("Server side templating");rd.templating.serverSide=true}else{if(rd.templating.template===undefined){GravityRD.Log.usageError("GR-014")}}}}if(rd.templating&&rd.templating.template===undefined&&rd.templating.templateId===undefined){GravityRD.Log.usageError("GR-015")}if(rd.templating&&rd.templating.template!==undefined&&rd.templating.templateId!==undefined){GravityRD.Log.usageError("GR-030")}},getConfig:function(){var ret={};GravityRD.apply(ret,this.globalConfig);GravityRD.apply(ret,this.serverConfig);var ao=(this.serverConfig.allowOverride||[]);for(var i=0;i<ao.length;i++){if(this.globalConfig[ao[i]]!=undefined){ret[ao[i]]=this.globalConfig[ao[i]]}}return ret},request:function(){var dequeue=GravityRD.Core.Cookie.dequeueEvents()||[];var uid=this.globalConfig.userId;if(dequeue.length>0&&dequeue[0].__userId!==uid){GravityRD.Log.debug("Warning: 'uid' and 'euid' is different, possible misconfiguration issue. uid:"+uid+", euid:"+dequeue[0].__userId);var oldParams=this.params;this.initParams(null,dequeue);GravityRD.Core.Request.createRequest(this.getConfig(),this.params);this.params=oldParams;GravityRD.Core.Request.createRequest(this.getConfig(),this.params)}else{this.params.events=dequeue.concat(this.params.events);GravityRD.Core.Request.createRequest(this.getConfig(),this.params)}},scheduleRequest:function(ms){if(this.handle!=null){window.clearTimeout(this.handle)}if(ms>=0){window.setTimeout(GravityRD.bind(this.request,this),ms)}},process:function(queue,force){GravityRD.Log.group("Processing",true);var submit=this.firstCall;this.firstCall=false;submit|=(force||false);var config=GravityRD.Core.getConfig();for(var l=0;l<queue.length;l++){var command=queue[l];if(!(command.type==="set"||command.type==="fakeexception")){GravityRD.apply(command,this.globalNameValues,false);command.__userId=this.globalConfig.userId}GravityRD.Typecheck.pushObjectChecker(command).validate();if(command.type==="recommendation"){GravityRD.Log.timeStamp("GR:RD");this.addRecommendationRequest(command);submit=true}else{if(command.type==="explanation"){this.addExplanationRequest(command);submit=true}else{if(command.type==="event"){this.addEvent(command)}else{if(command.type==="set"){this.set(command)}else{if(command.type==="fakeexception"){config=GravityRD.Core.getConfig();var ep=GravityRD.Core.Request.getEndpoint(config.retargeting,"JSServlet4");GravityRD.Core.Request.scriptTagRequest(ep,"ec=fake")}else{if(command.type==="register-recid"){if(config.enableRegisterRecId===true){for(var i=0;i<command.itemId.length;i++){GravityRD.Core.Cookie.registerRecId(command.itemId[i],command.recId)}}else{GravityRD.Log.usageError("GR-019")}}else{if(command.type==="domready"){GravityRD.CustomConfig.domready(command.apply,true)}else{if(command.type==="customconfig"){GravityRD.Log.timeStamp("GR:CC push");window.setTimeout((function(c){return function(){GravityRD.Log.timeStamp("GR:CC");GravityRD.Log.time("GR:CC");GravityRD.CustomConfig.set(c.config,c.environment,true);GravityRD.Log.timeEnd("GR:CC")}})(command),0)}else{if(command.type==="search"){GravityRD.Search.install(command);submit=false}else{GravityRD.Log.error("Invalid type specified for push object!",queue)}}}}}}}}}}GravityRD.Log.groupEnd();if(config.deferEvents===false||submit){GravityRD.Log.debug("Immediate submit");this.scheduleRequest(-1);this.request()}else{GravityRD.Log.debug("Defered submit");GravityRD.Core.Cookie.queueEvents(this.params.events);this.params.events=[];this.scheduleRequest(config.deferEventsTime)}},initParams:function(o,e){this.params={events:e||[],requestNameValues:[],recommendationRequests:o||[],explanationRequests:[],templateData:{}};for(var i=0;i<this.params.recommendationRequests.length;i++){this.params.recommendationRequests[i].recommendationIndex=i}},saveParams:function(o){GravityRD.Log.debug("Remaining",o);this.parmsHistory.push(this.params);this.initParams(o);this.requestNumber++},useResultCB:function(result){GravityRD.Core.Request.useResultCB(result);GravityRD.Log.debug("useResultCB",result);if(result&&result.recommendationWrappers){var perfKey="GR:RD CB("+result.requestNumber+")";GravityRD.Log.timeStamp(perfKey);GravityRD.Log.time(perfKey);if(!!this.parmsHistory[result.requestNumber]){var resultPerf=this.parmsHistory[result.requestNumber].__perf;resultPerf.end();GravityRD.Log.debug("PERF",resultPerf.get(),true)}for(i=0;i<result.recommendationWrappers.length;i++){var recIndex=result.recommendationWrappers[i].recommendationIndex;var recRequest=this.parmsHistory[result.requestNumber].recommendationRequests[recIndex];var recommendation=result.recommendationWrappers[i].recommendation;recId=recommendation.recommendationId;recRequest.__rt_time=(+new Date())-recRequest.__stag_time;if(this.debug("stagtime")){this.addEvent({type:"event",eventType:"TRACK",rtTime:""+recRequest.__rt_time})}var perf=GravityRD.Perf.create("rec://"+recRequest.scenarioId+"/"+result.requestNumber+"/"+recIndex);if(recommendation.items!==undefined){(function(){var savedrec=recommendation;var savedrecid=recId;var savedURI="rec://"+recRequest.scenarioId+"/"+result.requestNumber+"/"+recIndex;window.setTimeout(function(){GravityRD.Log.group("Registering of recids for "+savedURI,true);for(var j=0;j<savedrec.items.length;j++){GravityRD.Core.Cookie.registerRecId(savedrec.items[j].itemid,savedrecid)}GravityRD.Log.groupEnd()},0)})()}perf.phase("register recid");if(recRequest.templating!==undefined){if(!recRequest.templating.serverSide){targetId=recRequest.templating.targetElementId;target=document.getElementById(targetId);recommendation.templateData=recRequest.templating.templateData;recommendation.template=recRequest.templating.template;recommendation._MODIFIERS=recRequest.templating.modifiers||{};GravityRD.apply(recommendation._MODIFIERS,modifiers);recommendation.template=recommendation.template.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");try{resultHTML=TrimPath.parseTemplate(recommendation.template).process(recommendation,{throwExceptions:true});if(recRequest.templating.replace===true){var wrapper=document.createElement("div");wrapper.innerHTML=resultHTML;while(wrapper.children.length!==0){target.parentNode.insertBefore(wrapper.children[0],target)}target.parentNode.removeChild(target)}else{target.innerHTML=resultHTML}}catch(e){GravityRD.Log.usageError("GR-028",e)}perf.phase("templating");if(GravityRD.Core.debug("perf")){var sheet=document.createElement("style");sheet.innerHTML=".gr_tooltip::after {background: rgba(0, 0, 0, 0.7);border-radius: 4px 4px 4px 4px;box-shadow: 2px 2px 16px rgba(0, 0, 0, 0.5);color: #FFF;content: attr(data-gr_tooltip);margin-top: -24px;padding: 3px 7px; position: absolute; opacity: 1; visibility: visible;transition: all 0.7s ease-in-out;}";document.body.appendChild(sheet);var info="N: "+perf.name+",Rt: "+recRequest.__rt_time+",Rr: "+perf.getPhases()["register recid"]+",Te: "+perf.getPhases()["templating"]+",Ca: "+perf.getPhases()["callback"];target.className=(target.className||"")+" gr_tooltip";target.setAttribute("data-gr_tooltip",info)}}else{if(recommendation.content!==undefined&&recRequest.templating.serverSide){var targetElement=document.getElementById(recRequest.templating.targetElementId);if(targetElement!==undefined){targetElement.innerHTML=recommendation.content}}}}if(recRequest.callback!==undefined){try{if(GravityRD.Core.debug("callback")){GravityRD.Log.debug("Evaluating callback",recRequest.callback)}recRequest.callback(recommendation,recRequest.templating)}catch(e){GravityRD.Log.error("Exception during callback evaluation (recommendation) ",e)}}perf.phase("callback");perf.end();GravityRD.Log.debug(perf.name,perf.get());GravityRD.each(this.listeners,function(listener){if(GravityRD.isFunction(listener.onRecommendationResponse)){listener.onRecommendationResponse.call(this,recRequest,recommendation)}},this)}GravityRD.Log.timeEnd(perfKey)}if(result&&result.explanationWrappers){for(var i=0;i<result.explanationWrappers.length;i++){var expIndex=result.explanationWrappers[i].explanationIndex;var expRequest=this.parmsHistory[result.requestNumber].explanationRequests[expIndex];var explanation=result.explanationWrappers[i].explanation;var recId=explanation.recommendationId;if(expRequest.templating!==undefined){var targetId=expRequest.templating.targetElementId;var target=document.getElementById(targetId);explanation.templateData=expRequest.templating.templateData;explanation.template=expRequest.templating.template;explanation._MODIFIERS=expRequest.templating.modifiers||{};GravityRD.apply(explanation._MODIFIERS,modifiers);explanation.template=explanation.template.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");var resultHTML=TrimPath.parseTemplate(explanation.template).process(explanation);if(expRequest.callback!==undefined){try{expRequest.callback(explanation,expRequest.templating)}catch(e){GravityRD.Log.error("Exception during callback evaluation (explanation)",e)}}}else{try{expRequest.callback(explanation)}catch(e){GravityRD.Log.error("Exception during callback evaluation (explanation)",e)}}}}},errorCB:function(rn,rri,eri){if(rri!==null){for(var i=0;i<rri.length;i++){var recIndex=rri[i];var recRequest=this.parmsHistory[rn].recommendationRequests[recIndex];if(recRequest.error!==undefined){try{recRequest.error(recRequest.templating)}catch(e){GravityRD.Log.error("Exception during error callback evaluation (recommendation) ",e)}}}}if(eri!==null){for(var i=0;i<eri.length;i++){var expIndex=eri[i];var expRequest=this.parmsHistory[rn].explanationRequests[expIndex];if(expRequest.error!==undefined){try{expRequest.error(expRequest.templating)}catch(e){GravityRD.Log.error("Exception during error callback evaluation (explanation) ",e)}}}}},parseTemplateVariables:function(input){var map={};var idx;while((idx=input.indexOf("${"))!=-1){input=input.substring(idx+2);var end=input.indexOf("}");if(end!=-1){var parName=input.substring(0,end);if(parName.indexOf("templateData.")==0){continue}if(parName.indexOf("|")!=-1){parName=parName.substring(0,parName.indexOf("|"))}if(parName.indexOf(".")!=-1){parName=parName.substring(parName.indexOf(".")+1);map[parName]=true}}}var ret=[];for(var k in map){ret.push(k)}return ret},onUsageError:function(msg){GravityRD.each(this.listeners,function(listener){if(GravityRD.isFunction(listener.onUsageError)){listener.onUsageError.call(this,msg)}},this)}});GravityRD.register("GravityRD","Core",new GravityRD_Core())})();(function(){var JSONSerializer=new GravityRD.extend(Object,{decodeValue:function(v){var o=null;try{o=grJSON3.parse(unescape(v))}catch(e){}return o},encodeValue:function(v){return escape(grJSON3.stringify(v))}});var LocalSessionStore=GravityRD.extend(Object,{set:function(name,value){localStorage.setItem(name,value)},get:function(name){return localStorage.getItem(name)}});var CookieSessionStore=GravityRD.extend(Object,{set:function(name,value){var config=GravityRD.Core.getConfig();var cookie=name+"="+value+";path="+config.cookiePath;var cookieDomainVal=GravityRD.Core.Cookie.resolveCookieDomain(config,document.location.host);if(cookieDomainVal!==null){cookie+=";domain="+cookieDomainVal}document.cookie=cookie},get:function(name){var cookie=document.cookie;if(cookie.length>0){var start=cookie.indexOf(name+"=");if(start!==-1){start=start+name.length+1;var c_end=cookie.indexOf(";",start);if(c_end===-1){c_end=cookie.length}return cookie.substring(start,c_end)}}return null}});var SessionStoreProvider=GravityRD.extend(Object,{instance:null,provide:function(){if(this.instance===null){var config=GravityRD.Core.getConfig();var localStoreEnabled=false;try{localStoreEnabled=!GravityRD.isUndefined(window.localStorage)&&config.sessionStorage===true}catch(e){}if(localStoreEnabled){try{window.localStorage.setItem("gr_localstoretest","test");window.localStorage.removeItem("gr_localstoretest")}catch(e){localStoreEnabled=false}}if(localStoreEnabled){this.instance=new LocalSessionStore()}else{this.instance=new CookieSessionStore()}}return this.instance}});var ClientObject=GravityRD.Base.extend({cookieName:null,handle:null,storageProvider:new SessionStoreProvider(),serializer:new JSONSerializer(),constructor:function(cookieName){this.cookieName=cookieName},getValue:function(key){var cookieRawVal=this.storageProvider.provide().get(this.cookieName);var cacheObj=this.serializer.decodeValue(cookieRawVal)||{};return cacheObj[key]},getAllValues:function(){var cookieRawVal=this.storageProvider.provide().get(this.cookieName);var cacheObj=this.serializer.decodeValue(cookieRawVal)||{};return cacheObj},setAllValues:function(values){this.storageProvider.provide().set(this.cookieName,this.serializer.encodeValue(values),0)},setValue:function(key,value){var cookieRawVal=this.storageProvider.provide().get(this.cookieName)||{};var cacheObj=(cookieRawVal!==null)?(this.serializer.decodeValue(cookieRawVal)||{}):{};cacheObj[key]=value;this.storageProvider.provide().set(this.cookieName,this.serializer.encodeValue(cacheObj),0)},removeValue:function(key){var cookieRawVal=this.storageProvider.provide().get(this.cookieName)||{};var cacheObj=(cookieRawVal!==null)?(this.serializer.decodeValue(cookieRawVal)||{}):{};delete cacheObj[key];this.storageProvider.provide().set(this.cookieName,this.serializer.encodeValue(cacheObj),0)},push:function(item,maxsize){var cookieRawVal=this.storageProvider.provide().get(this.cookieName);var cacheObj=(cookieRawVal!==null)?(this.serializer.decodeValue(cookieRawVal)||[]):[];cacheObj.push(item);if(maxsize!==undefined){if(cacheObj.length>maxsize){cacheObj=cacheObj.slice(cacheObj.length-maxsize)}}this.storageProvider.provide().set(this.cookieName,this.serializer.encodeValue(cacheObj),0)},get:function(){var cookieRawVal=this.storageProvider.provide().get(this.cookieName);var cacheObj=(cookieRawVal!==null)?this.serializer.decodeValue(cookieRawVal):null;return cacheObj}});var ClientSessionObject=ClientObject.extend({storageProvider:{instance:null,provide:function(){if(this.instance==null){this.instance=new CookieSessionStore()}return this.instance}}});var ExpiringClientObject=GravityRD.extend(Object,{values:null,times:null,handle:null,constructor:function(name){ExpiringClientObject.superclass.constructor(name);this.times=new ClientObject(name+"_ts");this.values=new ClientObject(name)},getValue:function(key){window.setTimeout(GravityRD.bind(this.clearOldValues,this),0);var d=+new Date();kd=this.times.getValue(key);if(this.timeout()===0||kd+this.timeout()>d){return this.values.getValue(key)}else{GravityRD.Log.debug("Removing key from "+this.cookieName+", because it expired: "+key+" (request)");this.values.removeValue(key);this.times.removeValue(key);return null}},setValue:function(key,value){window.setTimeout(GravityRD.bind(this.clearOldValues,this),0);this.values.setValue(key,value);this.times.setValue(key,+new Date())},clearOldValues:function(){var maxsize=this.maxSize();var d=+new Date()-this.timeout();var vall=this.values.getAllValues();var tall=this.times.getAllValues();var tlen=0;var kmin=null,karg=null;for(var k in tall){if(this.timeout()!==0&&tall[k]<d){GravityRD.Log.debug("Removing key from "+this.cookieName+", because it expired: "+k+" (thread)");delete tall[k];delete vall[k]}else{tlen++;if(kmin===null||tall[k]<kmin){kmin=tall[k];karg=k}}}if(tlen>maxsize&&karg!==null){GravityRD.Log.debug("Removing key from "+this.cookieName+", because it exceeds size limit: "+karg+" (thread)");delete tall[karg];delete vall[karg]}this.values.setAllValues(vall);this.times.setAllValues(tall)},getKeys:function(){var ret=[];for(var key in this.values.getAllValues()){ret.push(key)}return ret},timeout:function(){return 0},maxSize:function(){return 100}});var RecClickMapping=ExpiringClientObject.extend({timeout:function(){return(GravityRD.Core.getConfig()["recClickExpire"]||0)*1000},maxSize:function(){return GravityRD.Core.getConfig()["recClickTrackMax"]||20}});var Cart=ClientObject.extend({serializer:new JSONSerializer(),getItems:function(){return this.getAllValues()},addItem:function(itemId,quantity){var count=this.getValue(itemId)||0;if(quantity!==undefined){count+=quantity}else{count++}this.setValue(itemId,count)},removeItem:function(itemId,quantity){var count=this.getValue(itemId)||0;if(quantity!==undefined){count-=quantity}else{count--}if(count>0){this.setValue(itemId,count)}else{this.removeValue(itemId)}},removeItems:function(itemId){this.removeValue(itemId)}});var InMemoryObject=GravityRD.Base.extend({storage:{},getValue:function(key){return this.storage[key]},setValue:function(key,value){return this.storage[key]=value},getKeys:function(){var ret=[];for(var key in this.storage){ret.push(key)}return ret}});var RecIdMapping=GravityRD.Base.extend({local:new InMemoryObject(),registerRecId:function(itemId,recId){GravityRD.Log.debug("RegisterRecId for '"+itemId+"': '"+recId+"'");this.local.setValue(itemId,recId)},getRecId:function(itemId){var ret=this.local.getValue(itemId)||null;GravityRD.Log.debug("GetRecId for '"+itemId+"': '"+ret+"'");return ret}});var RandomSeed=ExpiringClientObject.extend({timeout:function(){return(GravityRD.Core.getConfig()["randomSeedExpire"]||10)*1000},maxSize:function(){return 1},getRandomSeed:function(){var rs=this.getValue("_");if(rs===null){rs=Math.floor(Math.random()*4294967296);this.setValue("_",rs)}return rs}});var GravityRD_Core_Cookie=GravityRD.Base.extend({__public__:["initSessionCookie","initPageCookie","getDebugCookie","setDebugCookie","getGeneratedCookie","setGeneratedCookie","registerRecId","getRecId","trackEvents","getTracking","getLastViewedItem","resolveCookieDomain","queueEvents","dequeueEvents","registerRecClickId","getRecClickId","getCookie","setCookie","retarget","randHexWord","getRandomSeed","addPersistentNameValue","getPersistentNameValues","addSessionNameValue","getSessionNameValues"],queueEventsTrack:new ClientObject("gr_track"),randomSeed:new RandomSeed("gr_rs"),initSessionCookie:function(){if(GravityRD.Core.getConfig()["trackSession"]===true){var cookieName="gr_session";var sid=GravityRD.Core.Cookie.getCookie(cookieName);if(sid===null){sid=(+new Date().getTime()).toString(16)+"-"+this.createRandomString();GravityRD.Core.Cookie.setCookie(cookieName,sid,false)}GravityRD.Core.setGlobalNameValue("sessionId",sid)}},initPageCookie:function(){if(GravityRD.Core.getConfig()["trackPage"]===true){var cookieName="gr_page";var sid=GravityRD.Core.Cookie.getCookie(cookieName);if(sid===null){sid=0}else{sid=sid*1+1}GravityRD.Core.Cookie.setCookie(cookieName,""+sid,false);GravityRD.Core.setGlobalNameValue("pageId",sid+"-"+this.randHexWord())}},getRandomSeed:function(){return this.randomSeed.getRandomSeed()},getDebugCookie:function(){var serializer=new JSONSerializer();var grdebug=this.getCookie("gr_debug");var json=serializer.decodeValue(grdebug)||{};return json},setDebugCookie:function(json){var serializer=new JSONSerializer();var enc=serializer.encodeValue(json);this.setCookie("gr_debug",enc)},queueEvents:function(x,key,overwrite){var k=key||"events";var queue=(!!overwrite)?[]:(this.queueEventsTrack.getValue(k)||[]);var nqueue=queue.concat(x);GravityRD.Log.debug("queueEvents ["+k+"]",nqueue);this.queueEventsTrack.setValue(k,nqueue)},dequeueEvents:function(key){var k=key||"events";var ret=this.queueEventsTrack.getValue(k);this.queueEventsTrack.setValue(k,[]);GravityRD.Log.debug("dequeueEvents ["+k+"]",ret);return ret},resolveCookieDomain:function(config,host){var cookieDomainVal=null;if(config.cookieDomain!==null){var cookieDomain=config.cookieDomain;var cookieDomainVal=null;var host=host.replace(/:\d+/,"");if(Object.prototype.toString.apply(cookieDomain)==="[object Array]"){for(var i=0;i<cookieDomain.length;i++){if(host.indexOf(cookieDomain[i])>-1){cookieDomainVal=cookieDomain[i];break}}if(cookieDomainVal===null){GravityRD.Log.error("Can't resolve cookiedomain for: "+host)}}else{if(typeof(cookieDomain)==="function"){cookieDomainVal=cookieDomain(host)}else{if(typeof(cookieDomain)==="string"){var m=cookieDomain.match(/level-(\d+)/);if(cookieDomain.match(/level-(\d+)/)!==null){var level=+m[1];var ld=host.split(".");var li=ld.length;while(--li>=0&&--level>=0){if(cookieDomainVal===null){cookieDomainVal=ld[li]}else{cookieDomainVal=ld[li]+"."+cookieDomainVal}}}else{if(cookieDomain.indexOf(".")>-1){cookieDomainVal=cookieDomain}else{GravityRD.Log.error("Unrecognized cookieDomain!")}}}}}}return cookieDomainVal},setCookie:function(name,value,expire){if(typeof(expire)==="undefined"){expire=+new Date()+1000*60*60*24*365}var config=GravityRD.Core.getConfig();var cookie=name+"="+escape(value)+(expire===false?"":";expires="+new Date(expire).toUTCString())+";path="+config.cookiePath+"";var cookieDomainVal=this.resolveCookieDomain(config,document.location.host);if(cookieDomainVal!==null){cookie+=";domain="+cookieDomainVal}GravityRD.Log.debug("setCookie: '"+cookie+"'");document.cookie=cookie},getCookie:function(name){var cookie=document.cookie;if(cookie.length>0){var start=cookie.indexOf(name+"=");if(start!==-1){start=start+name.length+1;var c_end=cookie.indexOf(";",start);if(c_end===-1){c_end=cookie.length}return unescape(cookie.substring(start,c_end))}}return null},getGeneratedCookie:function(val){var config=GravityRD.Core.getConfig();var name=config.cookieName;var cId=this.getCookie(name);if(config.useJsGeneratedCookie){var pattern=/[a-f0-9]{10,}-[a-f0-9]{16}/;if(cId!==null&&cId.match(pattern)===null){GravityRD.Core.Request.scriptTagRequest(GravityRD.Core.Request.getEndpoint(false,"JSServlet4"),"ec="+encodeURIComponent("INVALID CID")+"&ex="+encodeURIComponent(cId));cId=null}}if(cId===null){if(!GravityRD.isUndefined(val)){cId=val}else{var ts=+new Date().getTime();cId=ts.toString(16);cId+="-"+this.createRandomString()}GravityRD.Log.debug("Generating cookie ID [forced: "+(cId===val)+"]",cId);this.setCookie(name,cId)}return cId},setGeneratedCookie:function(val){var name=GravityRD.Core.getConfig()["cookieName"];var cId=this.getCookie(name);GravityRD.Log.debug("Generating cookie ID [forced: "+(cId===val)+"]",val);this.setCookie(name,val)},retarget:function(cId){var config=GravityRD.Core.getConfig();if(config.retargetingTrack===true&&config.retargeting===false){if(GravityRD.Core.Cookie.getCookie("gr_rt")!==cId){var ep=GravityRD.Core.Request.getEndpoint(true,"AdServlet");GravityRD.Core.Request.scriptTagRequest(ep,"action=setcookie&cid="+cId+"&customer="+config.partnerId);GravityRD.Core.Cookie.setCookie("gr_rt",cId,false)}}},lastViewedItem:null,recIdMapping:new RecIdMapping(),recClickMapping:new RecClickMapping("gr_click"),eventHistory:new ClientObject("gr_event"),cart:new Cart("gr_cart"),persistentNameValues:new ClientObject("gr_persist"),sessionNameValues:new ClientSessionObject("gr_ps"),trackEvents:function(rd){if(rd.eventType==="VIEW"){this.lastViewedItem=rd.itemId}else{if(rd.eventType==="ADD_TO_CART"){this.addToCartEvent(rd)}else{if(rd.eventType==="REMOVE_FROM_CART"){this.removeFromCartEvent(rd)}else{if(rd.eventType==="BUY"){this.buyEvent(rd)}}}}var config=GravityRD.Core.getConfig();if(config.trackEvents===true){var eventType=rd.eventType;var itemId=rd.itemId;var ta=(config.trackEventsFilter||{})[eventType];if(ta!==undefined){var pushObj=null;var extraFields=false;var extra={};var recId=null;if(ta.length>0){for(var i=0;i<ta.length;i++){if(rd[ta[i]]!==undefined){extra[ta[i]]=rd[ta[i]];extraFields=true}if(ta[i]==="recId"){recId=this.getRecId(itemId)}}}if(extraFields){pushObj=[eventType,itemId,recId,extra]}else{if(recId!==null){pushObj=[eventType,itemId,recId]}else{pushObj=[eventType,itemId]}}this.eventHistory.push(pushObj,config.trackEventsMaxSize)}}},getLastViewedItem:function(){return this.lastViewedItem},registerRecId:function(itemId,recId){this.recIdMapping.registerRecId(itemId,recId)},getRecId:function(itemId){return this.recIdMapping.getRecId(itemId)},registerRecClickId:function(itemId,recId){GravityRD.Log.debug("Registering recId '"+recId+"' for item '"+itemId+"'");this.recClickMapping.setValue(itemId,recId)},getRecClickId:function(itemId){return this.recClickMapping.getValue(itemId)},addToCartEvent:function(event){if(GravityRD.Core.getConfig()["trackCart"]===true){this.cart.addItem(event.itemId,event.quantity)}},removeFromCartEvent:function(event){if(GravityRD.Core.getConfig()["trackCart"]===true){this.cart.removeItem(event.itemId,event.quantity)}},buyEvent:function(event){if(GravityRD.Core.getConfig()["trackCart"]===true){this.cart.removeItems(event.itemId)}},getTracking:function(){return{cart:this.cart,eventHistory:this.eventHistory}},randHexWord:function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)},createRandomString:function(){return(this.randHexWord()+this.randHexWord()+this.randHexWord()+this.randHexWord())},addPersistentNameValue:function(name,value){if(value==null){this.persistentNameValues.removeValue(name)}else{this.persistentNameValues.setValue(name,value)}},addSessionNameValue:function(name,value){if(value==null){this.sessionNameValues.removeValue(name)}else{this.sessionNameValues.setValue(name,value)}},getPersistentNameValues:function(){return this.persistentNameValues.getAllValues()},getSessionNameValues:function(){return this.sessionNameValues.getAllValues()}});GravityRD.register("GravityRD.Core","Cookie",new GravityRD_Core_Cookie())})();(function(){var shortNameDictionary=[{name:"BUY",value:"e1"},{name:"VIEW",value:"e2"},{name:"ADD_TO_CART",value:"e3"},{name:"REMOVE_FROM_CART",value:"e4"},{name:"ADD_TO_FAVORITES",value:"e5"},{name:"REMOVE_FROM_FAVORITES",value:"e6"},{name:"ADD_TO_WISHLIST",value:"e7"},{name:"REMOVE_FROM_WISHLIST",value:"e8"},{name:"RATING",value:"e9"},{name:"REC_CLICK",value:"e10"},{name:"ItemID",value:"nv1"},{name:"Position",value:"nv2"},{name:"UnitPrice",value:"nv3"},{name:"Quantity",value:"nv4"},{name:"OrderId",value:"nv5"},{name:"Value",value:"nv6"},{name:"MAIN_PAGE",value:"si1"},{name:"CATEGORY_PAGE",value:"si2"},{name:"LISTING_PAGE",value:"si3"},{name:"ITEM_PAGE",value:"si4"},{name:"CART_PAGE",value:"si5"}];var GravityRD_Core_Request=GravityRD.Base.extend({__public__:["createRequest","setupRouting","scriptTagRequest","getEndpoint","useResultCB","_T","_U"],routes:[],routeTargets:{},nr:0,setupRouting:function(routes){var that=this;GravityRD.each(routes,function(routeConfig){var rc=GravityRD.apply(routeConfig,{predicate:function(){return true},disableDefaultTarget:false,additionalTargets:[]},false);var at=[];for(var i=0;i<rc.additionalTargets.length;i++){var cur=rc.additionalTargets[i];if(GravityRD.isString(cur)){var ncur={partner:cur};cur=ncur}if(cur.partner===null){GravityRD.Log.error("Partner not set in additionalTargets (skipping configuration): ",routeConfig);continue}that.routeTargets[cur.partner]={eventRequests:[]};at.push(GravityRD.apply(cur,{process:function(event){return event}},false))}rc.additionalTargets=at;that.routes.push(rc)});if(GravityRD.Core.debug("routing")){GravityRD.Log.group("Routing info");for(var i=0;i<this.routes.length;i++){GravityRD.Log.debug("R"+i,this.routes[i])}GravityRD.Log.debug("Route targets",this.routeTargets);GravityRD.Log.groupEnd()}},getShortNameValue:function(key){var develop=GravityRD.Core.getConfig()["mode"]==="DEVELOP";var ret="";if(key!==null&&key!==""){var exist=false;var i=0;while(!exist&&i<shortNameDictionary.length){exist=(key===shortNameDictionary[i].name);i++}if(exist&&!develop){ret="."+shortNameDictionary[i-1].value}else{ret="*"+key}}return ret},_T:function(string){if(string===null||string===undefined){return null}string=string.toString().replace(/-/g,"-0").replace(/,/g,"-1").replace(/;/g,"-2").replace(/\[/g,"-3").replace(/\]/g,"-4").replace(/:/g,"-5").replace(/\|/g,"-6");return this._E(string)},_U:function(string){if(string===null||string==undefined){return null}string=decodeURIComponent(string);string=string.toString().replace(/-6/g,"|").replace(/-5/g,":").replace(/-4/g,"]").replace(/-3/g,"[").replace(/-2/g,";").replace(/-1/g,",").replace(/-0/g,"-");return string},_E:function(string){return encodeURIComponent(string)},_TA:function(arr){var resultNamesEnc=[];for(var i=0;i<(arr||[]).length;i++){resultNamesEnc.push(this._T(arr[i]))}return resultNamesEnc.join(";")},getEndpoint:function(serverNameOrRetargeting,servletName,customerName){var config=GravityRD.Core.getConfig();var serverName=serverNameOrRetargeting;if(!GravityRD.isString(serverNameOrRetargeting)){if(serverNameOrRetargeting){var rs=config.retargetingServer;var rsa=rs.split(".");if(rsa[0]==config.partnerId&&!!customerName){rsa[0]=customerName;serverName=rsa.join(".")}else{serverName=rs}}else{serverName=config.targetServer}}var proto=document.location.protocol;if(proto==="file:"){proto="http:"}if(!!config.forceProtocol){proto=config.forceProtocol+":"}return proto+"//"+serverName+"/grrec-"+(customerName||config.partnerId)+"-war/"+servletName},useResultCB:function(result){var rn=result.requestNumber;var rri=[];var eri=[];if(result&&result.recommendationWrappers){for(i=0;i<result.recommendationWrappers.length;i++){rri.push(result.recommendationWrappers[i].recommendationIndex)}}if(result&&result.explanationWrappers){for(var i=0;i<result.explanationWrappers.length;i++){eri.push(result.explanationWrappers[i].explanationIndex)}}var cb=window.GravityRD["callback"+rn+"__"+rri.join("_")+"__"+eri.join("_")];if(cb){cb(result)}},scriptTagRequest:function(endpoint,params,rn,rri,eri){var that=this;var script=document.createElement("script");script.type="text/javascript";script.id="x_"+(that.nr++);function isIE(){var myNav=navigator.userAgent.toLowerCase();return(myNav.indexOf("msie")!=-1)?parseInt(myNav.split("msie")[1]):false}(function(){var lastValue;var done=0;var cleanUp=function(i){script.onreadystatechange=script.onload=script.onerror=null;(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).removeChild(script)};if(rri!=null&&eri!=null){window.GravityRD["callback"+rn+"__"+rri.join("_")+"__"+eri.join("_")]=function(result){lastValue=result};var notifySuccess=function(json){if(!(done++)){cleanUp()}};var notifyError=function(type){if(!(done++)){cleanUp();GravityRD.Core.errorCB(rn,rri,eri)}};if(isIE()&&isIE()<10){script.htmlFor=script.id;script.event="onclick"}script.onload=script.onerror=function(result){if(!script.readyState||!/i/.test(script.readyState)){try{script.onclick&&script.onclick()}catch(_){}result=lastValue;lastValue=0;result?notifySuccess(result[0]):notifyError("error")}}}script.src=endpoint+"?"+params;(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(script)})()},addNameValue:function(nameValues,n,v){var wrongAttributes=GravityRD.Core.getConfig()["wrongNameValues"]||[];for(var i=0;i<wrongAttributes.length;i++){if(wrongAttributes[i]===n){GravityRD.Log.usageError("GR-022",n)}}if(Object.prototype.toString.apply(v)==="[object Array]"){if(v.length>0){var s="";for(var i=0;i<v.length;i++){s+=(s==""?"":"|")+this._T(v[i])}nameValues.push(this._T(this.getShortNameValue(n))+":"+s)}}else{nameValues.push(this._T(this.getShortNameValue(n))+":"+this._T(v))}},serializeEvent:function(event){var eventDec=[];eventDec.push(this._T(this.getShortNameValue(event.eventType)));eventDec.push(this._T(event.itemId));var nameValues=[];for(var k in event){if(typeof(event[k])==="function"){continue}var kl=String(k).toLowerCase();if(kl.indexOf("__")===0){continue}if("type"===kl||"eventtype"===kl||"itemid"===kl){continue}if(event[k]!==undefined){this.addNameValue(nameValues,k,event[k])}}if(nameValues.length!==0){eventDec.push("["+nameValues.join(";")+"]")}var eventSer=eventDec.join(",");return eventSer},createGlobalData:function(addCookie,addUser,dontSetCookie){if(GravityRD.isUndefined(addCookie)){addCookie=true}if(GravityRD.isUndefined(addUser)){addUser=true}if(GravityRD.isUndefined(dontSetCookie)){dontSetCookie=false}var globalRecoData=[];var config=GravityRD.Core.getConfig();globalRecoData.push({name:"rn",value:GravityRD.Core.getRequestNumber()});if(config.userId!==null&&addUser){globalRecoData.push({name:"uid",value:this._E(config.userId)})}var cookieval=null;if(!config.retargeting&&addCookie){cookieval=config.cookieId;if(config.useJsGeneratedCookie){cookieval=GravityRD.Core.Cookie.getGeneratedCookie()}GravityRD.Core.Cookie.retarget(cookieval)}if(cookieval!==null){globalRecoData.push({name:"cid",value:this._E(cookieval)})}globalRecoData.push({name:"v",value:GravityRD.Core.getConfig()["buildSHA"]});if(dontSetCookie){globalRecoData.push({name:"dsc",value:"true"})}return globalRecoData},createRequest:function(config,params){if(config.partnerId===null){GravityRD.Log.usageError("GR-016");return}if(config.retargeting===false){if(config.cookieId===null&&config.useJsGeneratedCookie===false){GravityRD.Log.usageError("GR-017")}if(config.cookieId!==null&&config.useJsGeneratedCookie===true){GravityRD.Log.usageError("GR-018")}}for(var i=0;i<params.recommendationRequests.length;i++){params.recommendationRequests[i].__stag_time=+new Date()}params.__perf=GravityRD.Perf.create();var globalRecoData=this.createGlobalData();var eventRequests=[];var recommendationRequests=[];var explanationRequests=[];var routedebug=GravityRD.Core.debug("routing");routedebug&&GravityRD.Log.group("Route matching");if(params.events.length>0){for(var i=0;i<params.events.length;i++){var event=GravityRD.apply({},params.events[i]);if(routedebug){GravityRD.Log.group("Event "+event.eventType);GravityRD.Log.debug("Trying to match event",event)}var matched=false;var route=null;for(var j=0;j<this.routes.length&&!matched;j++){route=this.routes[j];matched=!!(new RegExp(route.eventType)).exec(event.eventType)&&route.predicate(event);if(matched){routedebug&&GravityRD.Log.debug("[+] Route matched",route);if(!route.disableDefaultTarget){eventRequests.push(this.serializeEvent(event))}for(var k=0;k<route.additionalTargets.length;k++){var at=route.additionalTargets[k];var pev=at.process(event);if(pev!==null){this.routeTargets[at.partner].eventRequests.push(this.serializeEvent(pev))}}break}else{routedebug&&GravityRD.Log.debug("[-] Route not matched",route)}}if(!matched){eventRequests.push(this.serializeEvent(event))}routedebug&&GravityRD.Log.groupEnd()}}routedebug&&GravityRD.Log.groupEnd();var remaining=[];if(params.recommendationRequests.length>0){for(var i=0;i<params.recommendationRequests.length;i++){var rr=params.recommendationRequests[i];if(rr.groupId!==undefined){if(rr.__completed!==true){remaining.push(rr);continue}else{if(rr.groupSeq===1){var ss=this.serializeRecRequest(rr);for(var last=rr;last.__next!==undefined;last=last.__next){ss+=this.serializeRecRequest(last.__next)}recommendationRequests.push(ss)}}}else{recommendationRequests.push(this.serializeRecRequest(rr))}}}if(params.explanationRequests.length>0){for(var i=0;i<params.explanationRequests.length;i++){var rr=params.explanationRequests[i];var rrDec=[];rrDec.push(rr.explanationIndex);rrDec.push(this._T(rr.scenarioId));rrDec.push(this._T(rr.numberLimit));rrDec.push(this._T(rr.recommendationId));rrDec.push("["+this._TA(rr.resultNames)+"]");rrDec.push("["+this._TA(rr.recommendedItemIds)+"]");var nameValues=[];for(var k in rr){if(typeof(rr[k])==="function"){continue}var kl=String(k).toLowerCase();if(kl.indexOf("__")===0){continue}if("explanationindex"===kl||"type"===kl||"scenarioid"===kl||"numberlimit"===kl||"templating"===kl||"resultnames"===kl||"callback"===kl||"recommendeditemids"===kl||"recommendationid"===kl){continue}this.addNameValue(nameValues,k,rr[k])}rrDec.push((nameValues.length>0)?"["+nameValues.join(";")+"]":"");explanationRequests.push(rrDec.join(","))}}params.__perf.phase("preprocess");GravityRD.Core.saveParams(remaining);var ep=GravityRD.Core.Request.getEndpoint(config.retargeting,"JSServlet4");this.createScriptTagRequests(ep,globalRecoData,eventRequests,recommendationRequests,explanationRequests,params.__perf);var config=GravityRD.Core.getConfig();for(var customer in this.routeTargets){var useUser=(config.routingGlobal[customer]||{}).useUser||config.routingGlobal.useUser||false;var globalData=this.createGlobalData(false,useUser,true);var routeTarget=this.routeTargets[customer];if(routeTarget.eventRequests.length>0){var ep=GravityRD.Core.Request.getEndpoint(true,"JSServlet4",customer);this.createScriptTagRequests(ep,globalData,routeTarget.eventRequests,[],[],params.__perf)}}},serializeRecRequest:function(rr){var rrDec=[];rrDec.push(rr.recommendationIndex);rrDec.push(this._T(rr.scenarioId));if(rr.templating&&rr.templating.serverSide){rrDec.push(rr.templating.templateId)}rrDec.push(this._T(rr.numberLimit||0));var nameValues=[];for(var k in rr){var kl=String(k).toLowerCase();if(kl.indexOf("__")===0){continue}if(typeof(rr[k])==="function"){continue}if("recommendationindex"===kl||"type"===kl||"scenarioid"===kl||"numberlimit"===kl||"templating"===kl||"resultnames"===kl||"callback"===kl){continue}this.addNameValue(nameValues,k,rr[k])}rrDec.push((nameValues.length>0)?"["+nameValues.join(";")+"]":"");rrDec.push("["+this._TA(rr.resultNames)+"]");var serialized=rrDec.join(",");if(rr.templating&&rr.templating.serverSide){serialized="&rs="+rrDec.join(",")}else{serialized="&rd="+rrDec.join(",")}return serialized},serializeCart:function(){var cart=GravityRD.Core.Cookie.getTracking()["cart"].get()||{};var cartS="";var cartItemIds=[];var empty=true;for(var i in cart){if(cart[i]!==null){empty=false;cartItemIds.push(i)}}if(!empty){var nameValues=[];this.addNameValue(nameValues,"CartItemId",cartItemIds);cartS=(nameValues.length>0)?"["+nameValues.join(";")+"]":""}return cartS},serializeEventHistory:function(maxsize){var eventHistory=GravityRD.Core.Cookie.getTracking()["eventHistory"].get()||[];var eventHistoryS="";for(var i=eventHistory.length-1;i>0;i--){var eventDesc=eventHistory[i];var event={type:"event",eventType:eventDesc[0],itemId:eventDesc[1]};if(eventDesc[2]!==undefined&&eventDesc[2]!==null){event.recId=eventDesc[2]}if(eventDesc[3]!==undefined){GravityRD.apply(event,eventDesc[3])}if(maxsize>0&&(eventHistoryS.length+1+this.serializeEvent(event).length)>maxsize){break}eventHistoryS=this.serializeEvent(event)+(eventHistoryS==""?"":"|")+eventHistoryS}return eventHistoryS},createScriptTagRequests:function(endpoint,globalRecoData,eventRequests,recommendationRequests,explanationRequests,perf){var queryLimit=2048-5-11;var gparms=[];for(var i=0;i<globalRecoData.length;i++){gparms.push(globalRecoData[i].name+"="+globalRecoData[i].value)}var baseUrl=gparms.join("&");var maxrun=recommendationRequests.length+eventRequests.length+explanationRequests.length;while(recommendationRequests.length!==0||eventRequests.length!==0||explanationRequests.length!==0){if(maxrun--<0){GravityRD.Log.error("Possible infinite loop");break}var src=baseUrl;var hadEvent=false;var hadRecommendation=false;if(eventRequests.length>0){hadEvent=true;if((eventRequests[0].length+3)>(queryLimit-src.length)){src+="&e="+eventRequests[0];eventRequests=eventRequests.slice(1);src+="&tr=1";GravityRD.Log.error("Query limit is too small to push event request");this.loadScripts(endpoint,src,null,null,perf);continue}else{while(eventRequests.length>0&&(eventRequests[0].length+3)<(queryLimit-src.length)){src+="&e="+eventRequests[0];eventRequests=eventRequests.slice(1)}}}var rri=[];var eri=[];if(recommendationRequests.length>0){var cartS=this.serializeCart();var histS=this.serializeEventHistory(0);if((recommendationRequests[0].length+4+cartS.length+5+histS.length+4)>=(queryLimit-src.length)){if(hadEvent){GravityRD.Log.debug("Pushing events");this.loadScripts(endpoint,src,null,null,perf);continue}var rrs=recommendationRequests[0];src+=rrs;rri.push(rrs.split(",")[0].split("=")[1]);src+="&grd="+cartS;var remaining=queryLimit-src.length-4;if(remaining>0){GravityRD.Log.debug("Remaining: "+remaining);src+="&eh="+this.serializeEventHistory(remaining)}src+="&tr=2";recommendationRequests=recommendationRequests.slice(1);GravityRD.Log.error("Query limit is too small to push recommendation request");this.loadScripts(endpoint,src,rri,eri,perf);rri=[];eri=[];continue}else{src+="&grd="+cartS;src+="&eh="+this.serializeEventHistory(0);while(recommendationRequests.length>0&&(recommendationRequests[0].length+4)<(queryLimit-src.length)){var rrs=recommendationRequests[0];src+=rrs;rri.push(rrs.split(",")[0].split("=")[1]);recommendationRequests=recommendationRequests.slice(1)}}}if(explanationRequests.length>0){if((explanationRequests[0].length+4)>=(queryLimit-src.length)){if(hadEvent||hadRecommendation){GravityRD.Log.debug("Pushing events");this.loadScripts(endpoint,src,rri,eri,perf);rri=[];eri=[];continue}var ers=explanationRequests[0];eri.push(ers.split(",")[0]);src+="&xp="+ers;var remaining=queryLimit-src.length-4;src+="&tr=3";explanationRequests=explanationRequests.slice(1);GravityRD.Log.error("Query limit is too small to push recommendation request");this.loadScripts(endpoint,src,rri,eri,perf);rri=[];eri=[];continue}else{while(explanationRequests.length>0&&(explanationRequests[0].length+4)<(queryLimit-src.length)){var ers=explanationRequests[0];eri.push(ers.split(",")[0]);src+="&xp="+ers;explanationRequests=explanationRequests.slice(1)}}}this.loadScripts(endpoint,src,rri,eri,perf)}},loadScripts:function(endpoint,url,rri,eri,perf){GravityRD.Log.timeStamp("GR:LOAD("+(GravityRD.Core.getRequestNumber()-1)+")");perf.phase("loadscripts");GravityRD.Log.group("LoadScripts "+endpoint,true);url.replace(/([^&]+)&?/g,function(_,p){GravityRD.Log.debug(p)});GravityRD.Core.Request.scriptTagRequest(endpoint,url+"&r="+GravityRD.Core.Cookie.randHexWord()+GravityRD.Core.Cookie.randHexWord(),GravityRD.Core.getRequestNumber()-1,rri,eri);GravityRD.Log.groupEnd();perf.phase("loadscriptsend")}});GravityRD.register("GravityRD.Core","Request",new GravityRD_Core_Request())})();(function(){var ErrorMessages={"GR-001":"Attribute '#1#' should have '#2#' type","GR-002":"Dom element with id '#1#' not found","GR-003":"Attribute '#1#' shouldn't be null","GR-004":"Parameter [#1#] of #2# should not be undefined","GR-005":"Parameter [#1#] of #2# should not be null","GR-006":"Parameter [#1#] of #2# should have '#3#' type","GR-007":"Invalid push item specified: '#1#'. Parameters to push() should have object type","GR-008":"Invalid type attribute in push item specified: '#1#'. Possible candidates: [#2#]","GR-009":"Invalid eventType attribute in push item specified: '#1#'. Possible candidates: [#2#]","GR-010":"Missing mandatory parameter: '#1#'. Push object: '#2#'","GR-011":"Invalid attribute in push item specified: '#1#'. Possible candidates: [#2#]","GR-012":"Either 'templating' or 'callback' attribute should be specified in recommendation push object","GR-013":"Both template and templateElementId specified","GR-014":"Neither template nor templateElementId specified","GR-015":"Initializing of templates failed","GR-016":"Please configure the 'partnerId'","GR-017":"CookieId is null, and autogeneration of cookies is disabled","GR-018":"CookieId is not null, and autogeneration of cookies is enabled","GR-019":"You don't have enough privileges to access this function","GR-020":"Array parameter [#1#] should have at least one element.","GR-021":"The value [#1#] for attribute '#2#' is suspicious. If you are sure it is valid, please contact us, to disable this feature!","GR-022":"Invalid push attribute [#1#] specified. Maybe you should try: {type:'set', #1#: [...]}","GR-023":"No 'groupSeq' attribute defined for group [#1#]","GR-024":"No 'groupSize' attribute defined for group [#1#]","GR-025":"Invalid 'groupSequence' attribute specified for group [#1#]. Got: #2#, expected: [#3#]}","GR-026":"Invalid 'groupSize' attribute specified for group [#1#], groupSize: [#2#]","GR-027":"Invalid 'groupSize' attribute specified for group [#1#], groupSize: [#2#], expected: [#3#]","GR-028":"Exception thrown by template rendering: '#1#'","GR-029":"Loading the javascript framework from this domain is not allowed","GR-030":"Server side and client side template rendering is not allowed on the same recommendation. (Use template or templateId, but not both)."};var GravityRD_Log_Logback=GravityRD.Base.extend({__public__:["debug","error","info","usageError","validationError","flush","message"],message:function(msg,obj){var res=msg+" ";if(obj!==undefined){res+=obj}res+="\n";return res},debug:function(msg,obj){this.log+=GravityRD.message(msg,obj)},info:function(msg,obj){this.log+=GravityRD.message(msg,obj)},error:function(msg,obj){this.log+=GravityRD.message("ERROR: "+msg,obj)},usageError:function(msg,obj){this.log+=GravityRD.message("USAGEERROR: "+msg,obj)},validationError:function(msg,obj){this.log+=GravityRD.message("VALIDATIONERROR: "+msg,obj)},flush:function(){var ss=1600;for(var p=0;p+ss<this.log.length;p+=ss){var config=GravityRD.Core.getConfig();var ep=GravityRD.Core.Request.getEndpoint(config.retargeting,"JSServlet4");GravityRD.Core.Request.scriptTagRequest(ep,"ex=CUSTOM&ec="+encodeURIComponent(this.log.slice(p,p+ss)))}this.log=""}});var GravityRD_Log_Firebug=GravityRD.Base.extend({__public__:["debug","error","info","group","groupEnd","timeStamp","time","timeEnd","usageError","validationError"],prefixes:[],haveConsole:function(){return(typeof(console)!=="undefined")},haveGroup:function(){return this.haveConsole()&&GravityRD.isFunction(console.group)&&GravityRD.isFunction(console.groupCollapsed)&&GravityRD.isFunction(console.groupEnd)&&GravityRD.Core.getConfig()["mode"]==="DEVELOP"},debug:function(msg,obj){if(this.haveConsole()){if(GravityRD.Core.getConfig()["mode"]==="DEVELOP"){if(obj!==undefined){console.log(this.prefix()+msg,obj)}else{console.log(this.prefix()+msg)}}}},group:function(groupName,collapsed){if(this.haveGroup()){if(collapsed===true){console.groupCollapsed(groupName)}else{console.group(groupName)}}else{this.prefixes.push(groupName)}},prefix:function(){if(!this.haveGroup()){return this.prefixes.join("::")+"::"}else{return""}},groupEnd:function(){if(this.haveGroup()){console.groupEnd()}else{this.prefixes.pop()}},info:function(msg,obj){if(this.haveConsole()){if(obj!==undefined){console.info(this.prefix()+msg,obj)}else{console.info(this.prefix()+msg)}}},error:function(msg,obj){if(this.haveConsole()){if(obj!==undefined){console.error(this.prefix()+msg,obj)}else{console.error(this.prefix()+msg)}}},timeStamp:function(str){if(GravityRD.Core.debug("perf")&&this.haveConsole()&&GravityRD.isFunction(console.timeStamp)){console.timeStamp(str)}},time:function(str){if(GravityRD.Core.debug("perf")&&this.haveConsole()&&GravityRD.isFunction(console.time)){console.time(str)}},timeEnd:function(str){if(GravityRD.Core.debug("perf")&&this.haveConsole()&&GravityRD.isFunction(console.timeEnd)){console.timeEnd(str)}},usageError:function(msg){var error=msg;if(msg.indexOf("GR-")===0&&ErrorMessages[msg]!==undefined){error=msg+":"+ErrorMessages[msg];for(var i=1;i<arguments.length;i++){error=error.replace(new RegExp("#"+i+"#","img"),arguments[i])}}else{this.error("Invalid error message specified")}if(this.haveConsole()){console.error(error)}var config=GravityRD.Core.getConfig();if(config.logExceptions===true){var ep=GravityRD.Core.Request.getEndpoint(config.retargeting,"JSServlet4");GravityRD.Core.Request.scriptTagRequest(ep,"ex="+encodeURIComponent(error)+"&ec="+encodeURIComponent(msg))}GravityRD.Core.onUsageError(error+" @"+window.location.href);if(!(msg==="GR-021")){throw new GravityRD.Exc(GravityRD.Exc.APIUSAGE,error)}},validationError:function(errors){if(this.haveConsole()){for(var i=0;i<errors.length;i++){GravityRD.Log.error("Error received from server, code="+errors[i].code+", message="+errors[i].msg)}}throw new GravityRD.Exc(GravityRD.Exc.VALIDATION,errors[0].code+":"+errors[0].msg)}});GravityRD.register("GravityRD","Log",new GravityRD_Log_Firebug())})();(function(){var AbstractTypechecker=GravityRD.Base.extend({});var ArgumentTypechecker=AbstractTypechecker.extend({constructor:function(name,args){this.name=name;this.args=args},validArg:function(pos){return(this.args.length>pos)},notNull:function(pos){if(!this.validArg(pos)||GravityRD.isNull(this.args[pos])){GravityRD.Log.usageError("GR-005",(pos+1),this.name)}return this},notUndefined:function(pos){if(!this.validArg(pos)||GravityRD.isUndefined(this.args[pos])){GravityRD.Log.usageError("GR-004",(pos+1),this.name)}return this},isObject:function(pos){if(!this.validArg(pos)||!GravityRD.isObject(this.args[pos])){GravityRD.Log.usageError("GR-006",(pos+1),this.name,"object")}return this}});var GlobalTypeDescription={set:{strict:false,optional:{partnerId:{type:"string"},userId:{type:"string",nullString:true,allowNull:true},cookieName:{type:"string",nullString:true},cookieId:{type:"string",nullString:true},useJsGeneratedCookie:{type:"boolean"}}},"register-recid":{strict:true,mandatory:{itemId:{type:"string",array:true,nullString:true},recId:{type:"string"}}},event:true,domready:{mandatory:{apply:{type:"function"}}},customconfig:{mandatory:{config:{type:"object"}}},fakeexception:{},recommendation:{mandatory:{scenarioId:{type:"string"}},optional:{numberLimit:{type:"integer"},resultNames:{type:"string",array:true},callback:{type:"function"},groupId:{type:"string"},groupSeq:{type:"integer"},groupSize:{type:"integer"},templating:{type:"object",descriptor:{mandatory:{targetElementId:{type:"dom"}},optional:{templateElementId:{type:"dom"},template:{type:"string"},templateData:{type:"object"},targetElementId:{type:"dom"},modifiers:{type:"object"}}}}}},explanation:{mandatory:{scenarioId:{type:"string"},numberLimit:{type:"integer"},recommendedItemIds:{type:"string",array:true},recommendationId:{type:"string"}},optional:{resultNames:{type:"string",array:true},callback:{type:"function"},templating:{type:"object",descriptor:{mandatory:{targetElementId:{type:"dom"}},optional:{templateElementId:{type:"dom"},template:{type:"string"},templateData:{type:"object"},targetElementId:{type:"dom"},modifiers:{type:"object"}}}}}},search:{mandatory:{count:{type:"integer"},inputSelector:{type:"string"},name:{type:"string"}},optional:{}}};var defEvDesc={mandatory:{eventType:{type:"string"},itemId:{type:"string",nullString:true}}};var emptyEvDesc={mandatory:{eventType:{type:"string"}}};var EventTypeDescription={FEEDBACK:defEvDesc,BUY:defEvDesc,MARK_BY_STAR:defEvDesc,MARK_FOR_LATER_WATCHING:defEvDesc,ADD_TO_FAVORITES:defEvDesc,USER_RECOMMEND:defEvDesc,RATING:defEvDesc,LANCE:defEvDesc,VIEW:defEvDesc,ADD_TO_CART:defEvDesc,REC_CLICK:defEvDesc,HIDE:defEvDesc,FREE_VIEW:defEvDesc,PAID_VIEW:defEvDesc,PRODUCT_SEARCH:emptyEvDesc,LETTER_SEND:emptyEvDesc,TEST_FILL:emptyEvDesc,LOGIN:emptyEvDesc,SHOW_ITEM:emptyEvDesc,SMS_SEND:emptyEvDesc,SUBSCRIBE:emptyEvDesc,LETTER_READ:emptyEvDesc,WATCH_LIVE:defEvDesc,WATCH_RECORDED:defEvDesc,WATCH_VOD_TRAILER:defEvDesc,WATCH_VOD:defEvDesc,RECORD:defEvDesc,REMOVE_FROM_FAVORITES:defEvDesc,SHOW_RECOMMENDATION:emptyEvDesc,NEXT_RECOMMENDATION:emptyEvDesc,ADD_TO_WISHLIST:defEvDesc,REMOVE_FROM_WISHLIST:defEvDesc,REMOVE_FROM_CART:defEvDesc,CLICK_OUT:defEvDesc,UNHIDE:defEvDesc,SHARE:defEvDesc,ASK_QUESTION:emptyEvDesc,COMMENT:defEvDesc,ADD_ITEM:defEvDesc,ADD_FRIEND:emptyEvDesc,DELETE_ITEM:defEvDesc,SUBSCRIPTION_VIEW:defEvDesc,FOLLOW_USER:emptyEvDesc,NOT_INTERESTED:defEvDesc,SMS_RECEIVE:emptyEvDesc,REDEEM:defEvDesc,BROWSE:emptyEvDesc,PREMIUM_VIEW:defEvDesc,CHAT:emptyEvDesc,LIKE:defEvDesc,DISLIKE:defEvDesc,BUY_INIT:emptyEvDesc,LEAVE_PAGE:emptyEvDesc,COMPARE:emptyEvDesc,LETTER_CLICK:emptyEvDesc,SMS_START:emptyEvDesc,GIFT_CLICK:emptyEvDesc,GIFT_SEND:emptyEvDesc,UNSUBSCRIBE:emptyEvDesc,MODIFY_ITEM:defEvDesc,QUANTITY_CHECK:defEvDesc,CLICK:defEvDesc,TRACK:emptyEvDesc,RETURN:defEvDesc,PHONE_CLICK:defEvDesc,ADD_TO_PLAYLIST:defEvDesc,PRINT_CLICK:defEvDesc,LINK_MODULE_CLICK:defEvDesc,GALLERY_CLICK:defEvDesc,SEARCH:emptyEvDesc,REMOVE_FROM_PLAYLIST:emptyEvDesc,WATCHED:emptyEvDesc,UNFOLLOW_USER:emptyEvDesc,BID:defEvDesc,IMPRESSION:defEvDesc,DOWNLOAD:defEvDesc,EMAIL_ALERT:emptyEvDesc,ADD_TO_WATCH_LIST:defEvDesc,USER_REGISTRATION:emptyEvDesc,POST_ITEM:emptyEvDesc,ITEM_ON_SCREEN:defEvDesc,REC_ON_SCREEN:emptyEvDesc,AGGREGATOR:emptyEvDesc,ACTION_TRIGGERED:emptyEvDesc,INTERNAL_A:emptyEvDesc,INTERNAL_B:emptyEvDesc,INTERNAL_C:emptyEvDesc,INTERNAL_D:emptyEvDesc,ERROR:emptyEvDesc,APPLY:defEvDesc,WATCH_LIVE_OTT:defEvDesc,WATCH:defEvDesc,BUY_CATCHUP:defEvDesc,WATCH_CATCHUP:defEvDesc,WATCH_VOD_OTT:defEvDesc,SUBSCRIPTION_VIEW_OTT:defEvDesc,BUY_ANONYM:defEvDesc,WATCH_VOD_ANONYM:defEvDesc,SUBSCRIPTION_VIEW_ANONYM:defEvDesc,WATCH_CATCHUP_ANONYM:defEvDesc,ADD_TO_BOOKMARK:defEvDesc};var NullStringChecker=AbstractTypechecker.extend({constructor:function(name){var config=GravityRD.Core.getConfig();this.name=name;this.nullStrings=config.nullStrings},checkNullString:function(val){for(var i=0;i<this.nullStrings.length;i++){if(this.nullStrings[i]===val){GravityRD.Log.usageError("GR-021",val,this.name)}}}});var PushObjectTypeChecker=AbstractTypechecker.extend({obj:null,constructor:function(obj){this.obj=obj},validate:function(){if(!GravityRD.isObject(this.obj)){GravityRD.Log.usageError("GR-007",this.obj)}var type=this.obj.type,k,candidates;if(GravityRD.isString(type)!==true||GlobalTypeDescription[type]===undefined){candidates="";for(k in GlobalTypeDescription){if(!GlobalTypeDescription.hasOwnProperty(k)){continue}candidates+=((candidates==="")?k:(","+k))}GravityRD.Log.usageError("GR-008",type,candidates)}var descriptor;if("event"==type){var subType=this.obj.eventType;if(GravityRD.isString(subType)!==true||EventTypeDescription[subType]===undefined){candidates="";for(k in EventTypeDescription){if(!EventTypeDescription.hasOwnProperty(k)){continue}candidates+=((candidates==="")?k:(","+k))}GravityRD.Log.usageError("GR-008",subType,candidates)}descriptor=EventTypeDescription[subType]}else{descriptor=GlobalTypeDescription[type]}this.validateAttributes(this.obj,descriptor)},validateAttributes:function(obj,descriptor){if(GravityRD.isUndefined(descriptor)){return}var mandatory=descriptor.mandatory||{};var optional=descriptor.optional||{};var candidates="",k;for(k in mandatory){if(!mandatory.hasOwnProperty(k)){continue}candidates+=((candidates==="")?k:(","+k))}for(k in optional){if(!optional.hasOwnProperty(k)){continue}candidates+=((candidates==="")?k:(","+k))}for(k in mandatory){if(!mandatory.hasOwnProperty(k)){continue}if(obj[k]===undefined){GravityRD.Log.usageError("GR-010",k,obj)}}for(k in obj){if(!obj.hasOwnProperty(k)){continue}if(k==="type"){continue}if(mandatory[k]!==undefined){this.validateAttribute(k,obj,mandatory[k],true)}else{if(optional[k]!==undefined){this.validateAttribute(k,obj,optional[k],false)}else{if(descriptor.strict===true){GravityRD.Log.usageError("GR-011",k,candidates)}}}}},validateAttribute:function(attrname,attrs,descriptor){var attrvalue=attrs[attrname];if(GravityRD.isNull(attrvalue)){if(descriptor.allowNull===true){return}else{GravityRD.Log.usageError("GR-003",attrname)}}if(descriptor.array===true){if(!GravityRD.isArray(attrvalue)){var val=[];val.push(attrvalue);attrs[attrname]=val;attrvalue=val}if(attrvalue.length==0){GravityRD.Log.usageError("GR-020",attrname)}else{attrvalue=attrvalue[0]}}if(descriptor.type!==undefined){var type=descriptor.type;if(type==="string"){if(!GravityRD.isString(attrvalue)){GravityRD.Log.usageError("GR-001",attrname,type)}else{if(descriptor.nullString===true){new NullStringChecker(attrname).checkNullString(attrvalue)}}}else{if(type==="integer"){if(typeof(attrvalue)!=="number"){GravityRD.Log.usageError("GR-001",attrname,type)}}else{if(type==="boolean"){if(typeof(attrvalue)!=="boolean"){GravityRD.Log.usageError("GR-001",attrname,type)}}else{if(type==="dom"){var element=document.getElementById(attrvalue);if(element===null){GravityRD.Log.usageError("GR-002",attrvalue)}}else{if(type==="object"){if(!GravityRD.isObject(attrvalue)){GravityRD.Log.usageError("GR-001",attrname,type)}this.validateAttributes(attrvalue,descriptor.descriptor)}else{if(type==="function"){if(!GravityRD.isFunction(attrvalue)){GravityRD.Log.usageError("GR-001",attrname,type)}}else{GravityRD.Log.error("Invalid type specified in the field descriptor: "+descriptor.type)}}}}}}}}});var GravityRD_Typecheck=GravityRD.Base.extend({__public__:["argumentChecker","pushObjectChecker","nullStringChecker"],argumentChecker:function(name,args){return new ArgumentTypechecker(name,args)},pushObjectChecker:function(o){return new PushObjectTypeChecker(o)},nullStringChecker:function(name){return new NullStringChecker(name)}});GravityRD.register("GravityRD","Typecheck",new GravityRD_Typecheck())})();(function(){var GravityRD_Worker_PushProcessor=GravityRD.extend(Object,{handle:null,equeue:[],queue:[],lastHash:-1,push:function(parm,sync){GravityRD.Log.debug("Push request:",parm);if(parm.type==="event"){var hash=GravityRD.hash(parm);if(hash===this.lastHash){GravityRD.Log.debug("Suppressed event because it has the same hash as the previous event",parm);return}this.lastHash=hash}if(GravityRD.Core.debug("eventbirth")&&parm.type==="event"){parm._I=(+new Date())+"_"+parseInt(Math.random()*9999,10);parm._S=(sync!==false)?"1":"0"}if(parm.type==="event"){this.equeue.push(parm);GravityRD.Core.Cookie.queueEvents(this.equeue,"push",true)}else{this.queue.push(parm)}this.schedule()},process:function(){this.handle=null;GravityRD.Log.group("Process queue");for(var i=0;i<this.queue.length;i++){GravityRD.Log.debug(""+i,this.queue[i])}GravityRD.Log.groupEnd();var fromCookie=GravityRD.Core.Cookie.dequeueEvents("push")||[];GravityRD.Core.process((this.queue||[]).concat(fromCookie));this.equeue=[];this.queue=[]},schedule:function(){this.clearPending();this.handle=window.setTimeout(GravityRD.bind(this.process,this),0)},clearPending:function(){if(this.handle!==null){window.clearTimeout(this.handle)}}});var pushProcessor=new GravityRD_Worker_PushProcessor();var GravityRD_Worker=GravityRD.Base.extend({__public__:["start"],keyHooked:false,installPushProcessor:function(){_gravity=pushProcessor;window.onunload=function(){if(GravityRD.Core.getConfig()["trackPageLeaveEvent"]===true){var last=GravityRD.Core.Cookie.getLastViewedItem();if(last!==null){_gravity.push({type:"event",eventType:"LEAVE_PAGE",itemId:last})}}};pushProcessor.schedule();GravityRD.Log.debug("Push processor installed")},processInitialArray:function(){for(var i=0;i<_gravity.length;i++){var item=_gravity[i];pushProcessor.push(item,false)}GravityRD.Log.debug("Initial array processed")},handleGravityHashCustom:function(){var hash=document.location.href.match("#gravity-?([^-]*)");if(hash!==null){if(""==hash[1]||"on"==hash[1]){GravityRD.Log.debug("Turning on customconfig in demo mode");GravityRD.Core.Cookie.setCookie("gr_custom","true")}else{if("session"===hash[1]){GravityRD.Core.Cookie.setCookie("gr_custom","true",false)}else{GravityRD.Core.Cookie.setCookie("gr_custom","false",0)}}}},hookCustomConfigInitKey:function(){if(!this.keyHooked){GravityRD.Log.debug("Hooking key");var demoKey=GravityRD.Core.getConfig()["customConfigDemoKey"];if(demoKey!==null){var keyCode=119;var match=demoKey.match("F([1-9][0-2]?)");if(match!==null){keyCode=111+1*match[1]}that=this;var callback=function(e){if(e.keyCode===keyCode){GravityRD.CustomConfig.init(true)}};if(document.addEventListener){document.addEventListener("keydown",callback,false)}else{document.attachEvent("onkeydown",callback)}}}this.keyHooked=true},handleCustomConfigMode:function(){if(GravityRD.CustomConfig!==undefined){var customConfig=GravityRD.Core.getConfig()["customConfig"];if(customConfig==="enabled"){GravityRD.CustomConfig.enable()}else{if(customConfig==="demo"){this.handleGravityHashCustom();var val=GravityRD.Core.Cookie.getCookie("gr_custom");if(val!==null){GravityRD.CustomConfig.enable()}this.hookCustomConfigInitKey()}}}},handleGravityHashDebug:function(){var hash=document.location.href.match("#gravity-debug-([^-]*)-([^-]*)");var debugJson=GravityRD.Core.Cookie.getDebugCookie()||{};if(hash!==null){var facet=hash[1].split(",");GravityRD.each(facet,function(f){if("on"==hash[2]){debugJson[f]=true}else{if("off"==hash[2]){debugJson[f]=false}}GravityRD.Log.debug("DEBUG_"+f,debugJson[f])});GravityRD.Core.Cookie.setDebugCookie(debugJson)}GravityRD.Core.debugMask(debugJson)},start:function(){this.handleCustomConfigMode();this.handleGravityHashDebug();GravityRD.Log.debug("Gravity object",window.gravity);_gravity=window._gravity||[];if(GravityRD.Core.debug("log")){GravityRD.Core.set({mode:"DEVELOP"})}GravityRD.Log.timeStamp("GR:start()");if(!GravityRD.isArray(_gravity)){GravityRD.Log.debug("Framework already initialized");return false}var pnv=GravityRD.Core.Cookie.getPersistentNameValues();GravityRD.each(GravityRD.keys(pnv),function(k){GravityRD.Log.debug("Loading persistent namevalue: "+k,pnv[k]);GravityRD.Core.addGlobalNameValue(k,pnv[k],true,false)});var snv=GravityRD.Core.Cookie.getSessionNameValues();GravityRD.each(GravityRD.keys(snv),function(k){GravityRD.Log.debug("Loading session namevalue: "+k,snv[k]);GravityRD.Core.addGlobalNameValue(k,snv[k],true,false)});for(var i=0;i<_gravity.length;i++){var item=_gravity[i];if(item.type==="set"){GravityRD.Core.set(item)}}var config=GravityRD.Core.getConfig();if(config.disabled===true){GravityRD.Log.usageError("GR-029");return}if(GravityRD.CustomConfig!==undefined){GravityRD.CustomConfig.init()}if(GravityRD.HUD!==undefined&&GravityRD.Core.debug("hud")){GravityRD.HUD.start()}if(!!window._gravity_init_jq){if(!!window.jQuery){window._gravity_init_jq(window.jQuery)}else{GravityRD.Log.debug("Typeahead support disabled because no jQuery found.")}}GravityRD.Log.debug("Customconfig initialized");GravityRD.Core.Cookie.setCookie("gr_recmap","",0);GravityRD.Core.Cookie.setCookie("gr_recmapkeys","",0);GravityRD.Core.Cookie.initSessionCookie();GravityRD.Core.Cookie.initPageCookie();var qp={};document.location.href.replace(/.*\?/,"").replace(/([^=]+)=([^#&]*)&?/g,function(_,a,b){try{qp[decodeURIComponent(a)]=decodeURIComponent(b)}catch(e){GravityRD.Log.debug("Invalid parameter: ",[a,b])}});if(!!qp.__iid&&!!qp.__rid){GravityRD.Core.Cookie.registerRecId(qp.__iid,qp.__rid);GravityRD.Log.debug("Registering '"+qp.__rid+"' for item '"+qp.__iid+"', reason: landing page.")}if(!!qp.__cid&&config.retargeting===true&&config.useJsGeneratedCookie===true){GravityRD.Core.Cookie.getGeneratedCookie(qp.__cid)}this.processInitialArray();this.installPushProcessor();GravityRD.Log.debug("Worker started");return true}});GravityRD.register("GravityRD","Worker",new GravityRD_Worker())})();(function(){var PerfObject=GravityRD.extend(Object,{startTime:null,endTime:null,lastTime:null,phaseNames:[],phases:{},name:null,constructor:function(name){this.name=name;this.lastTime=this.startTime=+new Date();this.phaseNames=[];this.phases={};this.endTime=null},phase:function(name){this.phaseNames.push(name);var currTime=+new Date();this.phases[name]=(currTime-this.lastTime);this.lastTime=currTime},end:function(name){if(name!=undefined){this.phase(name)}this.endTime=+new Date()},getTime:function(){if(this.endTime!=null){return this.endTime-this.startTime}else{return -1}},getPhases:function(){return this.phases},get:function(){return{diff:this.getTime(),phaseNames:this.phaseNames,phases:this.getPhases()}}});var GravityRD_Perf=GravityRD.Base.extend({__public__:["create","stat","dump"],perfObjectNames:[],perfObjects:{},create:function(name){var perfObj=new PerfObject();if(name!==undefined){this.attach(name,perfObj)}return perfObj},attach:function(name,perfobj){perfobj.name=name;this.perfObjectNames.push(name);this.perfObjects[name]=perfobj},get:function(name){return this.perfObjects[name]},stat:function(){return this.perfObjects},padR:function(s,d){while(s.length<(d||60)){s+=" "}return s},padL:function(s,d){while(s.length<(d||60)){s=" "+s}return s},dump:function(phases){var ret="";GravityRD.each(this.perfObjectNames,function(s){ret+=this.padR(s)+this.padL(""+this.perfObjects[s].getTime(),8)+" ms\n";if(phases===true){var perf=this.perfObjects[s].get();GravityRD.each(perf.phaseNames,function(name){ret+=this.padR("      - "+name)+this.padL(""+perf.phases[name],8)+" ms\n"},this)}},this);return ret}});GravityRD.register("GravityRD","Perf",new GravityRD_Perf())})();(function(){
/*! extracted from https://github.com/sindresorhus/multiline */
var reCommentContents=/\/\*!?(?:\@preserve)?[ \t]*(?:\r\n|\n)([\s\S]*?)(?:\r\n|\n)\s*\*\//;var stripIndent=function(str){var match=str.match(/^[ \t]*(?=[^\s])/gm);if(!match){return str}var indent=Math.min.apply(Math,match.map(function(el){return el.length}));var re=new RegExp("^[ \\t]{"+indent+"}","gm");return indent>0?str.replace(re,""):str};multiline=function(fn){if(typeof fn!=="function"){throw new TypeError("Expected a function.")}var match=reCommentContents.exec(fn.toString());if(!match){throw new TypeError("Multiline comment missing.")}return match[1]};multiline.stripIndent=function(fn){return stripIndent(multiline(fn))}})();
/*!
  * domready (c) Dustin Diaz 2012 - License MIT
  */
!function(name,definition){if(typeof module!="undefined"){module.exports=definition()}else{if(typeof define=="function"&&typeof define.amd=="object"){define(definition)}else{this[name]=definition()}}}("domready",function(ready){var fns=[],fn,f=false,doc=document,testEl=doc.documentElement,hack=testEl.doScroll,domContentLoaded="DOMContentLoaded",addEventListener="addEventListener",onreadystatechange="onreadystatechange",readyState="readyState",loadedRgx=hack?/^loaded|^c/:/^loaded|c/,loaded=loadedRgx.test(doc[readyState]);function flush(f){loaded=1;while(f=fns.shift()){f()}}doc[addEventListener]&&doc[addEventListener](domContentLoaded,fn=function(){doc.removeEventListener(domContentLoaded,fn,f);flush()},f);hack&&doc.attachEvent(onreadystatechange,fn=function(){if(/^c/.test(doc[readyState])){doc.detachEvent(onreadystatechange,fn);flush()}});return(ready=hack?function(fn){self!=top?loaded?fn():fns.push(fn):function(){try{testEl.doScroll("left")}catch(e){return setTimeout(function(){ready(fn)},50)}fn()}()}:function(fn){loaded?fn():fns.push(fn)})})
/*! JSON v3.3.2 | http://bestiejs.github.io/json3 | Copyright 2012-2014, Kit Cambridge | http://kit.mit-license.org */
;(function(){var isLoader=typeof define==="function"&&define.amd;var objectTypes={"function":true,object:true};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var root=objectTypes[typeof window]&&window||this,freeGlobal=freeExports&&objectTypes[typeof module]&&module&&!module.nodeType&&typeof global=="object"&&global;if(freeGlobal&&(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal)){root=freeGlobal}function runInContext(context,exports){context||(context=root.Object());exports||(exports=root.Object());var Number=context.Number||root.Number,String=context.String||root.String,Object=context.Object||root.Object,Date=context.Date||root.Date,SyntaxError=context.SyntaxError||root.SyntaxError,TypeError=context.TypeError||root.TypeError,Math=context.Math||root.Math,nativeJSON=context.JSON||root.JSON;if(typeof nativeJSON=="object"&&nativeJSON){exports.stringify=nativeJSON.stringify;exports.parse=nativeJSON.parse}var objectProto=Object.prototype,getClass=objectProto.toString,isProperty,forEach,undef;var isExtended=new Date(-3509827334573292);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name=="bug-string-char-index"){isSupported="a"[0]!="a"}else{if(name=="json"){isSupported=has("json-stringify")&&has("json-parse")}else{var value,serialized='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if(name=="json-stringify"){var stringify=exports.stringify,stringifySupported=typeof stringify=="function"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)==="0"&&stringify(new Number())==="0"&&stringify(new String())=='""'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)==="1"&&stringify([value])=="[1]"&&stringify([undef])=="[null]"&&stringify(null)=="null"&&stringify([undef,getClass,null])=="[null,null,null]"&&stringify({a:[value,true,false,null,"\x00\b\n\f\r\t"]})==serialized&&stringify(null,value)==="1"&&stringify([1,2],null,1)=="[\n 1,\n 2\n]"&&stringify(new Date(-8640000000000000))=='"-271821-04-20T00:00:00.000Z"'&&stringify(new Date(8640000000000000))=='"+275760-09-13T00:00:00.000Z"'&&stringify(new Date(-62198755200000))=='"-000001-01-01T00:00:00.000Z"'&&stringify(new Date(-1))=='"1969-12-31T23:59:59.999Z"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name=="json-parse"){var parse=exports.parse;if(typeof parse=="function"){try{if(parse("0")===0&&!parse(false)){value=parse(serialized);var parseSupported=value.a.length==5&&value.a[0]===1;if(parseSupported){try{parseSupported=!parse('"\t"')}catch(exception){}if(parseSupported){try{parseSupported=parse("01")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse("1.")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}}return has[name]=!!isSupported}if(!has("json")){var functionClass="[object Function]",dateClass="[object Date]",numberClass="[object Number]",stringClass="[object String]",arrayClass="[object Array]",booleanClass="[object Boolean]";var charIndexBuggy=has("bug-string-char-index");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty=objectProto.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in (this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties();for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!="function"&&objectTypes[typeof object.hasOwnProperty]&&object.hasOwnProperty||isProperty;for(property in object){if(!(isFunction&&property=="prototype")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property)){}}}else{if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property=="prototype")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property=="prototype")&&isProperty.call(object,property)&&!(isConstructor=property==="constructor")){callback(property)}}if(isConstructor||isProperty.call(object,(property="constructor"))){callback(property)}}}}return forEach(object,callback)};if(!has("json-stringify")){var Escapes={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"};var leadingZeroes="000000";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix="\\u00";var quote=function(value){var result='"',index=0,length=value.length,useCharIndex=!charIndexBuggy||length>10;var symbols=useCharIndex&&(charIndexBuggy?value.split(""):value);for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=useCharIndex?symbols[index]:value.charAt(index)}}return result+'"'};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value=="object"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,"toJSON")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/86400000);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++){}for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++){}date=1+date-getDay(year,month);time=(value%86400000+86400000)%86400000;hours=floor(time/3600000)%24;minutes=floor(time/60000)%60;seconds=floor(time/1000)%60;milliseconds=time%1000}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=10000?(year<0?"-":"+")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+"-"+toPaddedString(2,month+1)+"-"+toPaddedString(2,date)+"T"+toPaddedString(2,hours)+":"+toPaddedString(2,minutes)+":"+toPaddedString(2,seconds)+"."+toPaddedString(3,milliseconds)+"Z"}else{value=null}}else{if(typeof value.toJSON=="function"&&((className!=numberClass&&className!=stringClass&&className!=arrayClass)||isProperty.call(value,"toJSON"))){value=value.toJSON(property)}}}if(callback){value=callback.call(object,property,value)}if(value===null){return"null"}className=getClass.call(value);if(className==booleanClass){return""+value}else{if(className==numberClass){return value>-1/0&&value<1/0?""+value:"null"}else{if(className==stringClass){return quote(""+value)}}}if(typeof value=="object"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?"null":element)}result=results.length?(whitespace?"[\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"]":("["+results.join(",")+"]")):"[]"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+":"+(whitespace?" ":"")+element)}});result=results.length?(whitespace?"{\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"}":("{"+results.join(",")+"}")):"{}"}stack.pop();return result}};exports.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(objectTypes[typeof filter]&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else{if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],((className=getClass.call(value)),className==stringClass||className==numberClass)&&(properties[value]=1)){}}}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace="",width>10&&(width=10);whitespace.length<width;whitespace+=" "){}}}else{if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}}return serialize("",(value={},value[""]=source,value),callback,properties,whitespace,"",[])}}if(!has("json-parse")){var fromCharCode=String.fromCharCode;var Unescapes={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value="@",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else{if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode("0x"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&((charCode=source.charCodeAt(Index+1)),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&((charCode=source.charCodeAt(Index)),charCode>=48&&charCode<=57);Index++){}if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&((charCode=source.charCodeAt(position)),charCode>=48&&charCode<=57);position++){}if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&((charCode=source.charCodeAt(position)),charCode>=48&&charCode<=57);position++){}if(position==Index){abort()}Index=position}return +source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)=="true"){Index+=4;return true}else{if(source.slice(Index,Index+5)=="false"){Index+=5;return false}else{if(source.slice(Index,Index+4)=="null"){Index+=4;return null}}}abort()}}return"$"};var get=function(value){var results,hasMembers;if(value=="$"){abort()}if(typeof value=="string"){if((charIndexBuggy?value.charAt(0):value[0])=="@"){return value.slice(1)}if(value=="["){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value=="]"){break}if(hasMembers){if(value==","){value=lex();if(value=="]"){abort()}}else{abort()}}if(value==","){abort()}results.push(get(value))}return results}else{if(value=="{"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value=="}"){break}if(hasMembers){if(value==","){value=lex();if(value=="}"){abort()}}else{abort()}}if(value==","||typeof value!="string"||(charIndexBuggy?value.charAt(0):value[0])!="@"||lex()!=":"){abort()}results[value.slice(1)]=get(lex())}return results}}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value=="object"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};exports.parse=function(source,callback){var result,value;Index=0;Source=""+source;result=get(lex());if(lex()!="$"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[""]=result,value),"",callback):result}}}exports.runInContext=runInContext;return exports}if(freeExports&&!isLoader){runInContext(root,freeExports)}else{var nativeJSON=root.JSON,previousJSON=root.JSON3,isRestored=false;var JSON3=runInContext(root,(root.JSON3={noConflict:function(){if(!isRestored){isRestored=true;root.JSON=nativeJSON;root.JSON3=previousJSON;nativeJSON=previousJSON=null}return JSON3}}));root.JSON={parse:JSON3.parse,stringify:JSON3.stringify}}if(isLoader){define(function(){return JSON3})}}).call(this);grJSON3=JSON3.noConflict();if(typeof(TrimPath)=="undefined"){TrimPath={}}(function(){if(TrimPath.evalEx==null){TrimPath.evalEx=function(src){return eval(src)}}var UNDEFINED;if(Array.prototype.pop==null){Array.prototype.pop=function(){if(this.length===0){return UNDEFINED}return this[--this.length]}}if(Array.prototype.push==null){Array.prototype.push=function(){for(var i=0;i<arguments.length;++i){this[this.length]=arguments[i]}return this.length}}TrimPath.parseTemplate=function(tmplContent,optTmplName,optEtc){if(optEtc==null){optEtc=TrimPath.parseTemplate_etc}var funcSrc=parse(tmplContent,optTmplName,optEtc);var func=TrimPath.evalEx(funcSrc,optTmplName,1);if(func!=null){return new optEtc.Template(optTmplName,tmplContent,funcSrc,func,optEtc)}return null};var exceptionDetails=function(e){return(e.toString())+";\n "+(e.message)+";\n "+(e.name)+";\n "+(e.stack||"no stack trace")+";\n "+(e.description||"no further description")+";\n "+(e.fileName||"no file name")+";\n "+(e.lineNumber||"no line number")};try{String.prototype.process=function(context,optFlags){var template=TrimPath.parseTemplate(this,null);if(template!=null){return template.process(context,optFlags)}return this}}catch(e){}TrimPath.parseTemplate_etc={};TrimPath.parseTemplate_etc.statementTag="forelse|for|if|elseif|else|var|macro";TrimPath.parseTemplate_etc.statementDef={"if":{delta:1,prefix:"if (",suffix:") {",paramMin:1},"else":{delta:0,prefix:"} else {"},elseif:{delta:0,prefix:"} else if (",suffix:") {",paramDefault:"true"},"/if":{delta:-1,prefix:"}"},"for":{delta:1,paramMin:3,prefixFunc:function(stmtParts,state,tmplName,etc){if(stmtParts[2]!="in"){throw new etc.ParseError(tmplName,state.line,"bad for loop statement: "+stmtParts.join(" "))}var iterVar=stmtParts[1];var listVar="__LIST__"+iterVar;return["var ",listVar," = ",stmtParts[3],";","var __LENGTH_STACK__;","if (typeof(__LENGTH_STACK__) == 'undefined' || !__LENGTH_STACK__.length) __LENGTH_STACK__ = new Array();","__LENGTH_STACK__[__LENGTH_STACK__.length] = 0;","if ((",listVar,") != null) { ","var ",iterVar,"_ct = 0;","for (var ",iterVar,"_index in ",listVar,") { ",iterVar,"_ct++;","if (typeof(",listVar,"[",iterVar,"_index]) == 'function') {continue;}","__LENGTH_STACK__[__LENGTH_STACK__.length - 1]++;","var ",iterVar," = ",listVar,"[",iterVar,"_index];"].join("")}},forelse:{delta:0,prefix:"} } if (__LENGTH_STACK__[__LENGTH_STACK__.length - 1] == 0) { if (",suffix:") {",paramDefault:"true"},"/for":{delta:-1,prefix:"} }; delete __LENGTH_STACK__[__LENGTH_STACK__.length - 1];"},"var":{delta:0,prefix:"var ",suffix:";"},macro:{delta:1,prefixFunc:function(stmtParts,state,tmplName,etc){var macroName=stmtParts[1].split("(")[0];return["var ",macroName," = function",stmtParts.slice(1).join(" ").substring(macroName.length),"{ var _OUT_arr = []; var _OUT = { write: function(m) { if (m) _OUT_arr.push(m); } }; "].join("")}},"/macro":{delta:-1,prefix:" return _OUT_arr.join(''); };"}};TrimPath.parseTemplate_etc.modifierDef={eat:function(v){return""},escape:function(s){return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},capitalize:function(s){return String(s).toUpperCase()},"default":function(s,d){return s!=null?s:d}};TrimPath.parseTemplate_etc.modifierDef.h=TrimPath.parseTemplate_etc.modifierDef.escape;TrimPath.parseTemplate_etc.Template=function(tmplName,tmplContent,funcSrc,func,etc){this.process=function(context,flags){if(context==null){context={}}if(context._MODIFIERS==null){context._MODIFIERS={}}if(context.defined==null){context.defined=function(str){return(context[str]!=undefined)}}for(var k in etc.modifierDef){if(context._MODIFIERS[k]==null){context._MODIFIERS[k]=etc.modifierDef[k]}}if(flags==null){flags={}}var resultArr=[];var resultOut={write:function(m){resultArr.push(m)}};try{func(resultOut,context,flags)}catch(e){if(flags.throwExceptions==true){throw e}var result=new String(resultArr.join("")+"[ERROR: template: <pre>"+exceptionDetails(e)+"</pre>]");result.exception=e;return result}return resultArr.join("")};this.name=tmplName;this.source=tmplContent;this.sourceFunc=funcSrc;this.toString=function(){return"TrimPath.Template ["+tmplName+"]"}};TrimPath.parseTemplate_etc.ParseError=function(name,line,message){this.name=name;this.line=line;this.message=message};TrimPath.parseTemplate_etc.ParseError.prototype.toString=function(){return("TrimPath template ParseError in "+this.name+": line "+this.line+", "+this.message)};var parse=function(body,tmplName,etc){body=cleanWhiteSpace(body);var funcText=["var TrimPath_Template_TEMP = function(_OUT, _CONTEXT, _FLAGS) { with (_CONTEXT) {"];var state={stack:[],line:1};var endStmtPrev=-1;while(endStmtPrev+1<body.length){var begStmt=endStmtPrev;begStmt=body.indexOf("{",begStmt+1);while(begStmt>=0){var endStmt=body.indexOf("}",begStmt+1);var stmt=body.substring(begStmt,endStmt);var blockrx=stmt.match(/^\{(cdata|minify|eval)/);if(blockrx){var blockType=blockrx[1];var blockMarkerBeg=begStmt+blockType.length+1;var blockMarkerEnd=body.indexOf("}",blockMarkerBeg);if(blockMarkerEnd>=0){var blockMarker;if(blockMarkerEnd-blockMarkerBeg<=0){blockMarker="{/"+blockType+"}"}else{blockMarker=body.substring(blockMarkerBeg+1,blockMarkerEnd)}var blockEnd=body.indexOf(blockMarker,blockMarkerEnd+1);if(blockEnd>=0){emitSectionText(body.substring(endStmtPrev+1,begStmt),funcText);var blockText=body.substring(blockMarkerEnd+1,blockEnd);if(blockType=="cdata"){emitText(blockText,funcText)}else{if(blockType=="minify"){emitText(scrubWhiteSpace(blockText),funcText)}else{if(blockType=="eval"){if(blockText!=null&&blockText.length>0){funcText.push("_OUT.write( (function() { "+blockText+" })() );")}}}}begStmt=endStmtPrev=blockEnd+blockMarker.length-1}}}else{if(body.charAt(begStmt-1)!="$"&&body.charAt(begStmt-1)!="\\"){var offset=(body.charAt(begStmt+1)=="/"?2:1);if(body.substring(begStmt+offset,begStmt+10+offset).search(TrimPath.parseTemplate_etc.statementTag)==0){break}}}begStmt=body.indexOf("{",begStmt+1)}if(begStmt<0){break}var endStmt=body.indexOf("}",begStmt+1);if(endStmt<0){break}emitSectionText(body.substring(endStmtPrev+1,begStmt),funcText);emitStatement(body.substring(begStmt,endStmt+1),state,funcText,tmplName,etc);endStmtPrev=endStmt}emitSectionText(body.substring(endStmtPrev+1),funcText);if(state.stack.length!=0){throw new etc.ParseError(tmplName,state.line,"unclosed, unmatched statement(s): "+state.stack.join(","))}funcText.push("}}; TrimPath_Template_TEMP");return funcText.join("")};var emitStatement=function(stmtStr,state,funcText,tmplName,etc){var parts=stmtStr.slice(1,-1).split(" ");var stmt=etc.statementDef[parts[0]];if(stmt==null){emitSectionText(stmtStr,funcText);return}if(stmt.delta<0){if(state.stack.length<=0){throw new etc.ParseError(tmplName,state.line,"close tag does not match any previous statement: "+stmtStr)}state.stack.pop()}if(stmt.delta>0){state.stack.push(stmtStr)}if(stmt.paramMin!=null&&stmt.paramMin>=parts.length){throw new etc.ParseError(tmplName,state.line,"statement needs more parameters: "+stmtStr)}if(stmt.prefixFunc!=null){funcText.push(stmt.prefixFunc(parts,state,tmplName,etc))}else{funcText.push(stmt.prefix)}if(stmt.suffix!=null){if(parts.length<=1){if(stmt.paramDefault!=null){funcText.push(stmt.paramDefault)}}else{for(var i=1;i<parts.length;i++){if(i>1){funcText.push(" ")}funcText.push(parts[i])}}funcText.push(stmt.suffix)}};var emitSectionText=function(text,funcText){if(text.length<=0){return}var nlPrefix=0;var nlSuffix=text.length-1;while(nlPrefix<text.length&&(text.charAt(nlPrefix)=="\n")){nlPrefix++}while(nlSuffix>=0&&(text.charAt(nlSuffix)==" "||text.charAt(nlSuffix)=="\t")){nlSuffix--}if(nlSuffix<nlPrefix){nlSuffix=nlPrefix}if(nlPrefix>0){funcText.push('if (_FLAGS.keepWhitespace == true) _OUT.write("');var s=text.substring(0,nlPrefix).replace("\n","\\n");if(s.charAt(s.length-1)=="\n"){s=s.substring(0,s.length-1)}funcText.push(s);funcText.push('");')}var lines=text.substring(nlPrefix,nlSuffix+1).split("\n");for(var i=0;i<lines.length;i++){emitSectionTextLine(lines[i],funcText);if(i<lines.length-1){funcText.push('_OUT.write("\\n");\n')}}if(nlSuffix+1<text.length){funcText.push('if (_FLAGS.keepWhitespace == true) _OUT.write("');var s=text.substring(nlSuffix+1).replace("\n","\\n");if(s.charAt(s.length-1)=="\n"){s=s.substring(0,s.length-1)}funcText.push(s);funcText.push('");')}};var emitSectionTextLine=function(line,funcText){var endMarkPrev="}";var endExprPrev=-1;while(endExprPrev+endMarkPrev.length<line.length){var begMark="${",endMark="}";var begExpr=line.indexOf(begMark,endExprPrev+endMarkPrev.length);if(begExpr<0){break}if(line.charAt(begExpr+2)=="%"){begMark="${%";endMark="%}"}var endExpr=line.indexOf(endMark,begExpr+begMark.length);if(endExpr<0){break}emitText(line.substring(endExprPrev+endMarkPrev.length,begExpr),funcText);var exprArr=line.substring(begExpr+begMark.length,endExpr).replace(/\|\|/g,"#@@#").split("|");for(var k in exprArr){if(exprArr[k].replace){exprArr[k]=exprArr[k].replace(/#@@#/g,"||")}}funcText.push("_OUT.write(");emitExpression(exprArr,exprArr.length-1,funcText);funcText.push(");");endExprPrev=endExpr;endMarkPrev=endMark}emitText(line.substring(endExprPrev+endMarkPrev.length),funcText)};var emitText=function(text,funcText){if(text==null||text.length<=0){return}text=text.replace(/\\/g,"\\\\");text=text.replace(/\n/g,"\\n");text=text.replace(/"/g,'\\"');funcText.push('_OUT.write("');funcText.push(text);funcText.push('");')};var emitExpression=function(exprArr,index,funcText){var expr=exprArr[index];if(index<=0){funcText.push(expr);return}var parts=expr.split(":");funcText.push('_MODIFIERS["');funcText.push(parts[0]);funcText.push('"](');emitExpression(exprArr,index-1,funcText);if(parts.length>1){funcText.push(",");funcText.push(parts[1])}funcText.push(")")};var cleanWhiteSpace=function(result){result=result.replace(/\t/g,"    ");result=result.replace(/\r\n/g,"\n");result=result.replace(/\r/g,"\n");result=result.replace(/^(\s*\S*(\s+\S+)*)\s*$/,"$1");return result};var scrubWhiteSpace=function(result){result=result.replace(/^\s+/g,"");result=result.replace(/\s+$/g,"");result=result.replace(/\s+/g," ");result=result.replace(/^(\s*\S*(\s+\S+)*)\s*$/,"$1");return result};TrimPath.parseDOMTemplate=function(elementId,optDocument,optEtc){if(optDocument==null){optDocument=document}var element=optDocument.getElementById(elementId);var content=element.value;if(content==null){content=element.innerHTML}content=content.replace(/&lt;/g,"<").replace(/&gt;/g,">");return TrimPath.parseTemplate(content,elementId,optEtc)};TrimPath.processDOMTemplate=function(elementId,context,optFlags,optDocument,optEtc){return TrimPath.parseDOMTemplate(elementId,optDocument,optEtc).process(context,optFlags)}})();GravityRD.bind(function use_private_scope(){
/*!
  * @preserve Qwery - A Blazing Fast query selector engine
  * https://github.com/ded/qwery
  * copyright Dustin Diaz 2012
  * MIT License
  */
(function(name,context,definition){if(typeof module!="undefined"&&module.exports){module.exports=definition()}else{if(typeof define=="function"&&define.amd){define(definition)}else{context[name]=definition()}}})("qwery",this,function(){var doc=document,html=doc.documentElement,byClass="getElementsByClassName",byTag="getElementsByTagName",qSA="querySelectorAll",useNativeQSA="useNativeQSA",tagName="tagName",nodeType="nodeType",select,id=/#([\w\-]+)/,clas=/\.[\w\-]+/g,idOnly=/^#([\w\-]+)$/,classOnly=/^\.([\w\-]+)$/,tagOnly=/^([\w\-]+)$/,tagAndOrClass=/^([\w]+)?\.([\w\-]+)$/,splittable=/(^|,)\s*[>~+]/,normalizr=/^\s+|\s*([,\s\+\~>]|$)\s*/g,splitters=/[\s\>\+\~]/,splittersMore=/(?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/,specialChars=/([.*+?\^=!:${}()|\[\]\/\\])/g,simple=/^(\*|[a-z0-9]+)?(?:([\.\#]+[\w\-\.#]+)?)/,attr=/\[([\w\-]+)(?:([\|\^\$\*\~]?\=)['"]?([ \w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^]+)["']?)?\]/,pseudo=/:([\w\-]+)(\(['"]?([^()]+)['"]?\))?/,easy=new RegExp(idOnly.source+"|"+tagOnly.source+"|"+classOnly.source),dividers=new RegExp("("+splitters.source+")"+splittersMore.source,"g"),tokenizr=new RegExp(splitters.source+splittersMore.source),chunker=new RegExp(simple.source+"("+attr.source+")?("+pseudo.source+")?");var walker={" ":function(node){return node&&node!==html&&node.parentNode},">":function(node,contestant){return node&&node.parentNode==contestant.parentNode&&node.parentNode},"~":function(node){return node&&node.previousSibling},"+":function(node,contestant,p1,p2){if(!node){return false}return(p1=previous(node))&&(p2=previous(contestant))&&p1==p2&&p1}};function cache(){this.c={}}cache.prototype={g:function(k){return this.c[k]||undefined},s:function(k,v,r){v=r?new RegExp(v):v;return(this.c[k]=v)}};var classCache=new cache(),cleanCache=new cache(),attrCache=new cache(),tokenCache=new cache();function classRegex(c){return classCache.g(c)||classCache.s(c,"(^|\\s+)"+c+"(\\s+|$)",1)}function each(a,fn){var i=0,l=a.length;for(;i<l;i++){fn(a[i])}}function flatten(ar){for(var r=[],i=0,l=ar.length;i<l;++i){arrayLike(ar[i])?(r=r.concat(ar[i])):(r[r.length]=ar[i])}return r}function arrayify(ar){var i=0,l=ar.length,r=[];for(;i<l;i++){r[i]=ar[i]}return r}function previous(n){while(n=n.previousSibling){if(n[nodeType]==1){break}}return n}function q(query){return query.match(chunker)}function interpret(whole,tag,idsAndClasses,wholeAttribute,attribute,qualifier,value,wholePseudo,pseudo,wholePseudoVal,pseudoVal){var i,m,k,o,classes;if(this[nodeType]!==1){return false}if(tag&&tag!=="*"&&this[tagName]&&this[tagName].toLowerCase()!==tag){return false}if(idsAndClasses&&(m=idsAndClasses.match(id))&&m[1]!==this.id){return false}if(idsAndClasses&&(classes=idsAndClasses.match(clas))){for(i=classes.length;i--;){if(!classRegex(classes[i].slice(1)).test(this.className)){return false}}}if(pseudo&&qwery.pseudos[pseudo]&&!qwery.pseudos[pseudo](this,pseudoVal)){return false}if(wholeAttribute&&!value){o=this.attributes;for(k in o){if(Object.prototype.hasOwnProperty.call(o,k)&&(o[k].name||k)==attribute){return this}}}if(wholeAttribute&&!checkAttr(qualifier,getAttr(this,attribute)||"",value)){return false}return this}function clean(s){return cleanCache.g(s)||cleanCache.s(s,s.replace(specialChars,"\\$1"))}function checkAttr(qualify,actual,val){switch(qualify){case"=":return actual==val;case"^=":return actual.match(attrCache.g("^="+val)||attrCache.s("^="+val,"^"+clean(val),1));case"$=":return actual.match(attrCache.g("$="+val)||attrCache.s("$="+val,clean(val)+"$",1));case"*=":return actual.match(attrCache.g(val)||attrCache.s(val,clean(val),1));case"~=":return actual.match(attrCache.g("~="+val)||attrCache.s("~="+val,"(?:^|\\s+)"+clean(val)+"(?:\\s+|$)",1));case"|=":return actual.match(attrCache.g("|="+val)||attrCache.s("|="+val,"^"+clean(val)+"(-|$)",1))}return 0}function _qwery(selector,_root){var r=[],ret=[],i,l,m,token,tag,els,intr,item,root=_root,tokens=tokenCache.g(selector)||tokenCache.s(selector,selector.split(tokenizr)),dividedTokens=selector.match(dividers);if(!tokens.length){return r}token=(tokens=tokens.slice(0)).pop();if(tokens.length&&(m=tokens[tokens.length-1].match(idOnly))){root=byId(_root,m[1])}if(!root){return r}intr=q(token);els=root!==_root&&root[nodeType]!==9&&dividedTokens&&/^[+~]$/.test(dividedTokens[dividedTokens.length-1])?function(r){while(root=root.nextSibling){root[nodeType]==1&&(intr[1]?intr[1]==root[tagName].toLowerCase():1)&&(r[r.length]=root)}return r}([]):root[byTag](intr[1]||"*");for(i=0,l=els.length;i<l;i++){if(item=interpret.apply(els[i],intr)){r[r.length]=item}}if(!tokens.length){return r}each(r,function(e){if(ancestorMatch(e,tokens,dividedTokens)){ret[ret.length]=e}});return ret}function is(el,selector,root){if(isNode(selector)){return el==selector}if(arrayLike(selector)){return !!~flatten(selector).indexOf(el)}var selectors=selector.split(","),tokens,dividedTokens;while(selector=selectors.pop()){tokens=tokenCache.g(selector)||tokenCache.s(selector,selector.split(tokenizr));dividedTokens=selector.match(dividers);tokens=tokens.slice(0);if(interpret.apply(el,q(tokens.pop()))&&(!tokens.length||ancestorMatch(el,tokens,dividedTokens,root))){return true}}return false}function ancestorMatch(el,tokens,dividedTokens,root){var cand;function crawl(e,i,p){while(p=walker[dividedTokens[i]](p,e)){if(isNode(p)&&(interpret.apply(p,q(tokens[i])))){if(i){if(cand=crawl(p,i-1,p)){return cand}}else{return p}}}}return(cand=crawl(el,tokens.length-1,el))&&(!root||isAncestor(cand,root))}function isNode(el,t){return el&&typeof el==="object"&&(t=el[nodeType])&&(t==1||t==9)}function uniq(ar){var a=[],i,j;o:for(i=0;i<ar.length;++i){for(j=0;j<a.length;++j){if(a[j]==ar[i]){continue o}}a[a.length]=ar[i]}return a}function arrayLike(o){return(typeof o==="object"&&isFinite(o.length))}function normalizeRoot(root){if(!root){return doc}if(typeof root=="string"){return qwery(root)[0]}if(!root[nodeType]&&arrayLike(root)){return root[0]}return root}function byId(root,id,el){return root[nodeType]===9?root.getElementById(id):root.ownerDocument&&(((el=root.ownerDocument.getElementById(id))&&isAncestor(el,root)&&el)||(!isAncestor(root,root.ownerDocument)&&select('[id="'+id+'"]',root)[0]))}function qwery(selector,_root){var m,el,root=normalizeRoot(_root);if(!root||!selector){return[]}if(selector===window||isNode(selector)){return !_root||(selector!==window&&isNode(root)&&isAncestor(selector,root))?[selector]:[]}if(selector&&arrayLike(selector)){return flatten(selector)}if(m=selector.match(easy)){if(m[1]){return(el=byId(root,m[1]))?[el]:[]}if(m[2]){return arrayify(root[byTag](m[2]))}if(hasByClass&&m[3]){return arrayify(root[byClass](m[3]))}}return select(selector,root)}function collectSelector(root,collector){return function(s){var oid,nid;if(splittable.test(s)){if(root[nodeType]!==9){if(!(nid=oid=root.getAttribute("id"))){root.setAttribute("id",nid="__qwerymeupscotty")}s='[id="'+nid+'"]'+s;collector(root.parentNode||root,s,true);oid||root.removeAttribute("id")}return}s.length&&collector(root,s,false)}}var isAncestor="compareDocumentPosition" in html?function(element,container){return(container.compareDocumentPosition(element)&16)==16}:"contains" in html?function(element,container){container=container[nodeType]===9||container==window?html:container;return container!==element&&container.contains(element)}:function(element,container){while(element=element.parentNode){if(element===container){return 1}}return 0},getAttr=function(){var e=doc.createElement("p");return((e.innerHTML='<a href="#x">x</a>')&&e.firstChild.getAttribute("href")!="#x")?function(e,a){return a==="class"?e.className:(a==="href"||a==="src")?e.getAttribute(a,2):e.getAttribute(a)}:function(e,a){return e.getAttribute(a)}}(),hasByClass=!!doc[byClass],hasQSA=doc.querySelector&&doc[qSA],selectQSA=function(selector,root){var result=[],ss,e;try{if(root[nodeType]===9||!splittable.test(selector)){return arrayify(root[qSA](selector))}each(ss=selector.split(","),collectSelector(root,function(ctx,s){e=ctx[qSA](s);if(e.length==1){result[result.length]=e.item(0)}else{if(e.length){result=result.concat(arrayify(e))}}}));return ss.length>1&&result.length>1?uniq(result):result}catch(ex){}return selectNonNative(selector,root)},selectNonNative=function(selector,root){var result=[],items,m,i,l,r,ss;selector=selector.replace(normalizr,"$1");if(m=selector.match(tagAndOrClass)){r=classRegex(m[2]);items=root[byTag](m[1]||"*");for(i=0,l=items.length;i<l;i++){if(r.test(items[i].className)){result[result.length]=items[i]}}return result}each(ss=selector.split(","),collectSelector(root,function(ctx,s,rewrite){r=_qwery(s,ctx);for(i=0,l=r.length;i<l;i++){if(ctx[nodeType]===9||rewrite||isAncestor(r[i],root)){result[result.length]=r[i]}}}));return ss.length>1&&result.length>1?uniq(result):result},configure=function(options){if(typeof options[useNativeQSA]!=="undefined"){select=!options[useNativeQSA]?selectNonNative:hasQSA?selectQSA:selectNonNative}};configure({useNativeQSA:true});qwery.configure=configure;qwery.uniq=uniq;qwery.is=is;qwery.pseudos={};return qwery});
/*!
  * Bonzo: DOM Utility (c) Dustin Diaz 2012
  * https://github.com/ded/bonzo
  * License MIT
  */
(function(name,context,definition){if(typeof module!="undefined"&&module.exports){module.exports=definition()}else{if(typeof define=="function"&&define.amd){define(definition)}else{context[name]=definition()}}})("bonzo",this,function(){var win=window,doc=win.document,html=doc.documentElement,parentNode="parentNode",specialAttributes=/^(checked|value|selected|disabled)$/i,specialTags=/^(select|fieldset|table|tbody|tfoot|td|tr|colgroup)$/i,simpleScriptTagRe=/\s*<script +src=['"]([^'"]+)['"]>/,table=["<table>","</table>",1],td=["<table><tbody><tr>","</tr></tbody></table>",3],option=["<select>","</select>",1],noscope=["_","",0,1],tagMap={thead:table,tbody:table,tfoot:table,colgroup:table,caption:table,tr:["<table><tbody>","</tbody></table>",2],th:td,td:td,col:["<table><colgroup>","</colgroup></table>",2],fieldset:["<form>","</form>",1],legend:["<form><fieldset>","</fieldset></form>",2],option:option,optgroup:option,script:noscope,style:noscope,link:noscope,param:noscope,base:noscope},stateAttributes=/^(checked|selected|disabled)$/,hasClass,addClass,removeClass,uidMap={},uuids=0,digit=/^-?[\d\.]+$/,dattr=/^data-(.+)$/,px="px",setAttribute="setAttribute",getAttribute="getAttribute",features=function(){var e=doc.createElement("p");return{transform:function(){var props=["transform","webkitTransform","MozTransform","OTransform","msTransform"],i;for(i=0;i<props.length;i++){if(props[i] in e.style){return props[i]}}}(),classList:"classList" in e}}(),whitespaceRegex=/\s+/,toString=String.prototype.toString,unitless={lineHeight:1,zoom:1,zIndex:1,opacity:1,boxFlex:1,WebkitBoxFlex:1,MozBoxFlex:1},query=doc.querySelectorAll&&function(selector){return doc.querySelectorAll(selector)};function getStyle(el,property){var value=null,computed=doc.defaultView.getComputedStyle(el,"");computed&&(value=computed[property]);return el.style[property]||value}function isNode(node){return node&&node.nodeName&&(node.nodeType==1||node.nodeType==11)}function normalize(node,host,clone){var i,l,ret;if(typeof node=="string"){return bonzo.create(node)}if(isNode(node)){node=[node]}if(clone){ret=[];for(i=0,l=node.length;i<l;i++){ret[i]=cloneNode(host,node[i])}return ret}return node}function classReg(c){return new RegExp("(^|\\s+)"+c+"(\\s+|$)")}function each(ar,fn,opt_scope,opt_rev){var ind,i=0,l=ar.length;for(;i<l;i++){ind=opt_rev?ar.length-i-1:i;fn.call(opt_scope||ar[ind],ar[ind],ind,ar)}return ar}function deepEach(ar,fn,opt_scope){for(var i=0,l=ar.length;i<l;i++){if(isNode(ar[i])){deepEach(ar[i].childNodes,fn,opt_scope);fn.call(opt_scope||ar[i],ar[i],i,ar)}}return ar}function camelize(s){return s.replace(/-(.)/g,function(m,m1){return m1.toUpperCase()})}function decamelize(s){return s?s.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase():s}function data(el){el[getAttribute]("data-node-uid")||el[setAttribute]("data-node-uid",++uuids);var uid=el[getAttribute]("data-node-uid");return uidMap[uid]||(uidMap[uid]={})}function clearData(el){var uid=el[getAttribute]("data-node-uid");if(uid){delete uidMap[uid]}}function dataValue(d){var f;try{return(d===null||d===undefined)?undefined:d==="true"?true:d==="false"?false:d==="null"?null:(f=parseFloat(d))==d?f:d}catch(e){}return undefined}function some(ar,fn,opt_scope){for(var i=0,j=ar.length;i<j;++i){if(fn.call(opt_scope||null,ar[i],i,ar)){return true}}return false}function styleProperty(p){(p=="transform"&&(p=features.transform))||(/^transform-?[Oo]rigin$/.test(p)&&(p=features.transform+"Origin"));return p?camelize(p):null}function insert(target,host,fn,rev){var i=0,self=host||this,r=[],nodes=query&&typeof target=="string"&&target.charAt(0)!="<"?query(target):target;each(normalize(nodes),function(t,j){each(self,function(el){fn(t,r[i++]=j>0?cloneNode(self,el):el)},null,rev)},this,rev);self.length=i;each(r,function(e){self[--i]=e},null,!rev);return self}function xy(el,x,y){var $el=bonzo(el),style=$el.css("position"),offset=$el.offset(),rel="relative",isRel=style==rel,delta=[parseInt($el.css("left"),10),parseInt($el.css("top"),10)];if(style=="static"){$el.css("position",rel);style=rel}isNaN(delta[0])&&(delta[0]=isRel?0:el.offsetLeft);isNaN(delta[1])&&(delta[1]=isRel?0:el.offsetTop);x!=null&&(el.style.left=x-offset.left+delta[0]+px);y!=null&&(el.style.top=y-offset.top+delta[1]+px)}if(features.classList){hasClass=function(el,c){return el.classList.contains(c)};addClass=function(el,c){el.classList.add(c)};removeClass=function(el,c){el.classList.remove(c)}}else{hasClass=function(el,c){return classReg(c).test(el.className)};addClass=function(el,c){el.className=(el.className+" "+c).trim()};removeClass=function(el,c){el.className=(el.className.replace(classReg(c)," ")).trim()}}function setter(el,v){return typeof v=="function"?v.call(el,el):v}function scroll(x,y,type){var el=this[0];if(!el){return this}if(x==null&&y==null){return(isBody(el)?getWindowScroll():{x:el.scrollLeft,y:el.scrollTop})[type]}if(isBody(el)){win.scrollTo(x,y)}else{x!=null&&(el.scrollLeft=x);y!=null&&(el.scrollTop=y)}return this}function Bonzo(elements){this.length=0;if(elements){elements=typeof elements!=="string"&&!elements.nodeType&&typeof elements.length!=="undefined"?elements:[elements];this.length=elements.length;for(var i=0;i<elements.length;i++){this[i]=elements[i]}}}Bonzo.prototype={get:function(index){return this[index]||null},each:function(fn,opt_scope){return each(this,fn,opt_scope)},deepEach:function(fn,opt_scope){return deepEach(this,fn,opt_scope)},map:function(fn,opt_reject){var m=[],n,i;for(i=0;i<this.length;i++){n=fn.call(this,this[i],i);opt_reject?(opt_reject(n)&&m.push(n)):m.push(n)}return m},html:function(h,opt_text){var method=opt_text?"textContent":"innerHTML",that=this,append=function(el,i){each(normalize(h,that,i),function(node){el.appendChild(node)})},updateElement=function(el,i){try{if(opt_text||(typeof h=="string"&&!specialTags.test(el.tagName))){return el[method]=h}}catch(e){}append(el,i)};return typeof h!="undefined"?this.empty().each(updateElement):this[0]?this[0][method]:""},text:function(opt_text){return this.html(opt_text,true)},append:function(node){var that=this;return this.each(function(el,i){each(normalize(node,that,i),function(i){el.appendChild(i)})})},prepend:function(node){var that=this;return this.each(function(el,i){var first=el.firstChild;each(normalize(node,that,i),function(i){el.insertBefore(i,first)})})},appendTo:function(target,opt_host){return insert.call(this,target,opt_host,function(t,el){t.appendChild(el)})},prependTo:function(target,opt_host){return insert.call(this,target,opt_host,function(t,el){t.insertBefore(el,t.firstChild)},1)},before:function(node){var that=this;return this.each(function(el,i){each(normalize(node,that,i),function(i){el[parentNode].insertBefore(i,el)})})},after:function(node){var that=this;return this.each(function(el,i){each(normalize(node,that,i),function(i){el[parentNode].insertBefore(i,el.nextSibling)},null,1)})},insertBefore:function(target,opt_host){return insert.call(this,target,opt_host,function(t,el){t[parentNode].insertBefore(el,t)})},insertAfter:function(target,opt_host){return insert.call(this,target,opt_host,function(t,el){var sibling=t.nextSibling;sibling?t[parentNode].insertBefore(el,sibling):t[parentNode].appendChild(el)},1)},replaceWith:function(node){var that=this;return this.each(function(el,i){each(normalize(node,that,i),function(i){el[parentNode]&&el[parentNode].replaceChild(i,el)})})},clone:function(opt_host){var ret=[],l,i;for(i=0,l=this.length;i<l;i++){ret[i]=cloneNode(opt_host||this,this[i])}return bonzo(ret)},addClass:function(c){c=toString.call(c).split(whitespaceRegex);return this.each(function(el){each(c,function(c){if(c&&!hasClass(el,setter(el,c))){addClass(el,setter(el,c))}})})},removeClass:function(c){c=toString.call(c).split(whitespaceRegex);return this.each(function(el){each(c,function(c){if(c&&hasClass(el,setter(el,c))){removeClass(el,setter(el,c))}})})},hasClass:function(c){c=toString.call(c).split(whitespaceRegex);return some(this,function(el){return some(c,function(c){return c&&hasClass(el,c)})})},toggleClass:function(c,opt_condition){c=toString.call(c).split(whitespaceRegex);return this.each(function(el){each(c,function(c){if(c){typeof opt_condition!=="undefined"?opt_condition?!hasClass(el,c)&&addClass(el,c):removeClass(el,c):hasClass(el,c)?removeClass(el,c):addClass(el,c)}})})},show:function(opt_type){opt_type=typeof opt_type=="string"?opt_type:"";return this.each(function(el){el.style.display=opt_type})},hide:function(){return this.each(function(el){el.style.display="none"})},toggle:function(opt_callback,opt_type){opt_type=typeof opt_type=="string"?opt_type:"";typeof opt_callback!="function"&&(opt_callback=null);return this.each(function(el){el.style.display=(el.offsetWidth||el.offsetHeight)?"none":opt_type;opt_callback&&opt_callback.call(el)})},first:function(){return bonzo(this.length?this[0]:[])},last:function(){return bonzo(this.length?this[this.length-1]:[])},next:function(){return this.related("nextSibling")},previous:function(){return this.related("previousSibling")},parent:function(){return this.related(parentNode)},related:function(method){return bonzo(this.map(function(el){el=el[method];while(el&&el.nodeType!==1){el=el[method]}return el||0},function(el){return el}))},focus:function(){this.length&&this[0].focus();return this},blur:function(){this.length&&this[0].blur();return this},css:function(o,opt_v){var p,iter=o;if(opt_v===undefined&&typeof o=="string"){opt_v=this[0];if(!opt_v){return null}if(opt_v===doc||opt_v===win){p=(opt_v===doc)?bonzo.doc():bonzo.viewport();return o=="width"?p.width:o=="height"?p.height:""}return(o=styleProperty(o))?getStyle(opt_v,o):null}if(typeof o=="string"){iter={};iter[o]=opt_v}function fn(el,p,v){for(var k in iter){if(iter.hasOwnProperty(k)){v=iter[k];(p=styleProperty(k))&&digit.test(v)&&!(p in unitless)&&(v+=px);try{el.style[p]=setter(el,v)}catch(e){}}}}return this.each(fn)},offset:function(opt_x,opt_y){if(opt_x&&typeof opt_x=="object"&&(typeof opt_x.top=="number"||typeof opt_x.left=="number")){return this.each(function(el){xy(el,opt_x.left,opt_x.top)})}else{if(typeof opt_x=="number"||typeof opt_y=="number"){return this.each(function(el){xy(el,opt_x,opt_y)})}}if(!this[0]){return{top:0,left:0,height:0,width:0}}var el=this[0],de=el.ownerDocument.documentElement,bcr=el.getBoundingClientRect(),scroll=getWindowScroll(),width=el.offsetWidth,height=el.offsetHeight,top=bcr.top+scroll.y-Math.max(0,de&&de.clientTop,doc.body.clientTop),left=bcr.left+scroll.x-Math.max(0,de&&de.clientLeft,doc.body.clientLeft);return{top:top,left:left,height:height,width:width}},dim:function(){if(!this.length){return{height:0,width:0}}var el=this[0],de=el.nodeType==9&&el.documentElement,orig=!de&&!!el.style&&!el.offsetWidth&&!el.offsetHeight?function(t){var s={position:el.style.position||"",visibility:el.style.visibility||"",display:el.style.display||""};t.first().css({position:"absolute",visibility:"hidden",display:"block"});return s}(this):null,width=de?Math.max(el.body.scrollWidth,el.body.offsetWidth,de.scrollWidth,de.offsetWidth,de.clientWidth):el.offsetWidth,height=de?Math.max(el.body.scrollHeight,el.body.offsetHeight,de.scrollHeight,de.offsetHeight,de.clientHeight):el.offsetHeight;orig&&this.first().css(orig);return{height:height,width:width}},attr:function(k,opt_v){var el=this[0],n;if(typeof k!="string"&&!(k instanceof String)){for(n in k){k.hasOwnProperty(n)&&this.attr(n,k[n])}return this}return typeof opt_v=="undefined"?!el?null:specialAttributes.test(k)?stateAttributes.test(k)&&typeof el[k]=="string"?true:el[k]:el[getAttribute](k):this.each(function(el){specialAttributes.test(k)?(el[k]=setter(el,opt_v)):el[setAttribute](k,setter(el,opt_v))})},removeAttr:function(k){return this.each(function(el){stateAttributes.test(k)?(el[k]=false):el.removeAttribute(k)})},val:function(s){return(typeof s=="string"||typeof s=="number")?this.attr("value",s):this.length?this[0].value:null},data:function(opt_k,opt_v){var el=this[0],o,m;if(typeof opt_v==="undefined"){if(!el){return null}o=data(el);if(typeof opt_k==="undefined"){each(el.attributes,function(a){(m=(""+a.name).match(dattr))&&(o[camelize(m[1])]=dataValue(a.value))});return o}else{if(typeof o[opt_k]==="undefined"){o[opt_k]=dataValue(this.attr("data-"+decamelize(opt_k)))}return o[opt_k]}}else{return this.each(function(el){data(el)[opt_k]=opt_v})}},remove:function(){this.deepEach(clearData);return this.detach()},empty:function(){return this.each(function(el){deepEach(el.childNodes,clearData);while(el.firstChild){el.removeChild(el.firstChild)}})},detach:function(){return this.each(function(el){el[parentNode]&&el[parentNode].removeChild(el)})},scrollTop:function(y){return scroll.call(this,null,y,"y")},scrollLeft:function(x){return scroll.call(this,x,null,"x")}};function cloneNode(host,el){var c=el.cloneNode(true),cloneElems,elElems,i;if(host.$&&typeof host.cloneEvents=="function"){host.$(c).cloneEvents(el);cloneElems=host.$(c).find("*");elElems=host.$(el).find("*");for(i=0;i<elElems.length;i++){host.$(cloneElems[i]).cloneEvents(elElems[i])}}return c}function isBody(element){return element===win||(/^(?:body|html)$/i).test(element.tagName)}function getWindowScroll(){return{x:win.pageXOffset||html.scrollLeft,y:win.pageYOffset||html.scrollTop}}function createScriptFromHtml(html){var scriptEl=document.createElement("script"),matches=html.match(simpleScriptTagRe);scriptEl.src=matches[1];return scriptEl}function bonzo(els){return new Bonzo(els)}bonzo.setQueryEngine=function(q){query=q;delete bonzo.setQueryEngine};bonzo.aug=function(o,target){for(var k in o){o.hasOwnProperty(k)&&((target||Bonzo.prototype)[k]=o[k])}};bonzo.create=function(node){return typeof node=="string"&&node!==""?function(){if(simpleScriptTagRe.test(node)){return[createScriptFromHtml(node)]}var tag=node.match(/^\s*<([^\s>]+)/),el=doc.createElement("div"),els=[],p=tag?tagMap[tag[1].toLowerCase()]:null,dep=p?p[2]+1:1,ns=p&&p[3],pn=parentNode;el.innerHTML=p?(p[0]+node+p[1]):node;while(dep--){el=el.firstChild}if(ns&&el&&el.nodeType!==1){el=el.nextSibling}do{if(!tag||el.nodeType==1){els.push(el)}}while(el=el.nextSibling);each(els,function(el){el[pn]&&el[pn].removeChild(el)});return els}():isNode(node)?[node.cloneNode(true)]:[]};bonzo.doc=function(){var vp=bonzo.viewport();return{width:Math.max(doc.body.scrollWidth,html.scrollWidth,vp.width),height:Math.max(doc.body.scrollHeight,html.scrollHeight,vp.height)}};bonzo.firstChild=function(el){for(var c=el.childNodes,i=0,j=(c&&c.length)||0,e;i<j;i++){if(c[i].nodeType===1){e=c[j=i]}}return e};bonzo.viewport=function(){return{width:win.innerWidth,height:win.innerHeight}};bonzo.isAncestor="compareDocumentPosition" in html?function(container,element){return(container.compareDocumentPosition(element)&16)==16}:function(container,element){return container!==element&&container.contains(element)};return bonzo})},privatescope)();(function(){var AbstractMatcher=GravityRD.extend(Object,{config:null,constructor:function(c){this.config=c},match:function(){return false},register:function(){}});var RegexpMatcher=GravityRD.extend(AbstractMatcher,{match:function(){var input=this.getInput();var pattern=new RegExp(this.config.pattern);this.matchoutput=pattern.exec(input);return !!this.matchoutput},register:function(){if(this.match()){if(!!this.matchoutput){var register=this.config.registerGroup||this.config.register;if(!!register){for(var i=1;i<this.matchoutput.length;i++){if(!!register[i]){var key=GravityRD.isObject(register[i])&&GravityRD.isString(register[i].key)?register[i].key:register[i];var value=GravityRD.isObject(register[i])&&GravityRD.isFunction(register[i].formatter)?register[i].formatter(this.matchoutput[i]):this.matchoutput[i];GravityRD.Core.setGlobalNameValue(key,value)}}if(!!register[0]){GravityRD.Core.setGlobalNameValue(register[0],"true")}}}}},getInput:function(){return""}});var URLPathRegexpMatcher=GravityRD.extend(RegexpMatcher,{getInput:function(){return document.location.pathname}});var HostRegexpMatcher=GravityRD.extend(RegexpMatcher,{getInput:function(){return document.location.host}});var URLRegexpMatcher=GravityRD.extend(RegexpMatcher,{getInput:function(){return document.location.href}});var URLQueryRegexpMatcher=GravityRD.extend(RegexpMatcher,{getInput:function(){var s=document.location.search;try{return decodeURIComponent(s)}catch(e){try{return decodeURI(s)}catch(e){return unescape(s)}}}});var CookieRegexpMatcher=GravityRD.extend(RegexpMatcher,{getInput:function(){return GravityRD.Core.Cookie.getCookie(this.config.cookieName)}});var ReferrerRegexpMatcher=GravityRD.extend(RegexpMatcher,{getInput:function(){return document.referrer}});var SelectorMatcher=GravityRD.extend(AbstractMatcher,{match:function(){this.$=GravityRD.CustomConfig.getDomEngine();this.nodelist=this.$(this.config.selector);return this.nodelist.length>0},register:function(){if(this.match()){var register=this.config.register||{};var regTmp={};GravityRD.each(this.nodelist,function(){for(var key in register){if(!register.hasOwnProperty(key)){continue}if(typeof(key)=="string"){var formatter;var exp;if(GravityRD.isObject(register[key])){exp=register[key].value;formatter=register[key].formatter}else{exp=register[key]}var val=exp.split("::");var regNodeList=this.$(val[0]);GravityRD.each(regNodeList,function(item){regTmp[key]=regTmp[key]||[];var value=null;if(val[1]=="text()"){value=item.childNodes[0].nodeValue}else{if(val[1]=="number()"){var childNodesLength=item.childNodes.length;var i=0;var notFound=true;while(notFound&&i<childNodesLength){if(item.childNodes[i].nodeValue!==null){value=item.childNodes[i].nodeValue.replace(/\s/g,"");if(value!==null){var regex=/([0-9]+)([.,\s][0-9]+)?/;var groups=regex.exec(value);if(groups!==undefined&&groups!==null&&groups.length>0){value=groups[0];notFound=false}else{value=null}if(value!==null){var delimiterChar=value.indexOf(".")>-1?".":value.indexOf(",")>-1?",":null;if(delimiterChar&&(value.length-1)-value.indexOf(delimiterChar)>2){value=value.replace(/[.,]/g,"")}}}}i++}}else{if(val[1]=="content()"){value=item.innerHTML.replace(/<script\b[^>]*>([\s\S]*?)<\/script>/gmi,"");value=value.replace(/<[^>]*>/g,"").trim().replace(/\s{2,}/g," ")}else{value=item[val[1]]}}}if(value!==null){if(GravityRD.isFunction(formatter)){value=formatter(value)}regTmp[key].push(value)}})}}},this);for(var key in regTmp){if(typeof(key)=="string"){if(regTmp[key]!=undefined&&regTmp[key].length>0){GravityRD.Core.setGlobalNameValue(key,regTmp[key])}}}}}});var DataLayerMatcher=GravityRD.extend(AbstractMatcher,{match:function(){try{var selector=""+this.config.selector;var value=dataLayer;selector.split(".").forEach(function(element){if(element.indexOf("[")!==-1){var condition=element.substring(1,element.length-1).split("=");var conditionKey=condition[0];var conditionValue=condition[1]||null;var i=0;var notFound=true;while(i<value.length&&notFound){for(var key in value[i]){if(key===conditionKey&&(condition.length===1||value[i][conditionKey]===conditionValue)){notFound=false;value=value[i]}}i++}}else{value=value[element]}});if(value!==undefined&&value!==null){this.value=value;return true}return false}catch(e){return false}},register:function(){if(this.match()){GravityRD.Core.setGlobalNameValue(this.config.name||this.config.varname,this.value)}}});var JSVarMatcher=GravityRD.extend(AbstractMatcher,{match:function(){try{eval("var value = "+this.config.varname+";");if(value!==undefined&&value!==null){this.value=value;return true}return false}catch(e){return false}},register:function(){if(this.match()){GravityRD.Core.setGlobalNameValue(this.config.name||this.config.varname,this.value)}}});var MetaTagMatcher=GravityRD.extend(AbstractMatcher,{match:function(){var metaTags=document.getElementsByTagName("meta");for(var i=0;i<metaTags.length;i++){if(metaTags[i].name===this.config.varname){this.value=metaTags[i].content;return true}}return false},register:function(){if(this.config.register){var register=this.config.register||{};var regTmp={};if(this.match()){for(var key in register){if(!register.hasOwnProperty(key)){continue}if(typeof(key)=="string"){var formatter;if(GravityRD.isObject(register[key])){formatter=register[key].formatter}else{formatter=register[key]}regTmp[key]=regTmp[key]||[];var value;if(GravityRD.isFunction(formatter)){value=formatter(this.value)}else{value=this.value}regTmp[key].push(value)}}}for(key in regTmp){if(typeof(key)=="string"){if(regTmp[key]!=undefined&&regTmp[key].length>0){GravityRD.Core.setGlobalNameValue(key,regTmp[key])}}}}}});var renamingStrategy={camelcase:function(input){var ia=input.split("-");var ret=ia[0];for(var i=1;i<ia.length;i++){ret+=ia[i].substring(0,1).toUpperCase();ret+=ia[i].substring(1)}return ret},identity:function(input){return input}};var MetaDataMatcher=GravityRD.extend(SelectorMatcher,{register:function(){if(this.match()){var rename=this.config.renamingStrategy||"camelcase";if(!GravityRD.isFunction(rename)){rename=renamingStrategy[rename];if(GravityRD.isUndefined(rename)){GravityRD.Log.error("Invalid renamingStrategy specified!")}}var register=this.config.register||{};var rh=this.config.registerHash;rh=rh===true?"_Hash":rh;var nv={};GravityRD.each(this.nodelist,function(element){GravityRD.each(element.getElementsByTagName("*"),function(node){var bnode=this.$(node);var name=bnode.data("name");var value=bnode.data("value");if(nv[name]===undefined){nv[name]=[]}nv[name].push(value);if(register===true){GravityRD.Core.addGlobalNameValue(rename(name),value)}else{if(register[name]!==undefined){if(register[name]===true){name=rename(name)}else{name=register[name]}GravityRD.Core.addGlobalNameValue(name,value)}}},this)},this);if(rh){var hash=GravityRD.hash(nv);GravityRD.Core.addGlobalNameValue(rh,""+hash)}}}});var UTMMatcher=GravityRD.extend(AbstractMatcher,{match:function(){return true},register:function(){GravityRD.each(this.config.source,function(sc){var paramMap=null;if(sc.type=="referrer"){paramMap=this.parseUrlParams(""+document.referrer)}else{if(sc.type=="location"){paramMap=this.parseUrlParams(""+document.location)}else{if(sc.type=="utmcookie"){var cookieVal=GravityRD.Core.Cookie.getCookie(this.config.utmcookie||"__utmz");paramMap=this.parseUTMCookieParams(cookieVal)}else{GravityRD.Log.error("Unknown source type specified: '"+sc.type+"'")}}}var cn=this.config.register.campaign;if(!!cn){var campaign=paramMap.utm_campaign||paramMap.utmccn||paramMap.utm_medium||paramMap.utmcmd||paramMap.utm_source||paramMap.utmcsr||paramMap.pk_campaign;if(!!campaign){GravityRD.Core.addGlobalNameValue(cn===true?"_Campaign":cn,campaign)}}var kw=this.config.register.keyword;if(!!kw){var keyword=paramMap.utm_term||paramMap.utmctr||paramMap.pk_keyword;if(!!keyword){GravityRD.Core.addGlobalNameValue(kw===true?"_Keyword":kw,keyword)}}},this)},parseUrlParams:function(input){var ret={};if(input!=null){input.replace(/.*\?/,"").replace(/([^=]+)=([^#&]*)&?/g,function(_,a,b){ret[decodeURIComponent(a)]=decodeURIComponent(b)})}return ret},parseUTMCookieParams:function(input){var ret={};if(input!=null){input.replace(/(utmc[^=]+)=([^|]*)/g,function(_,a,b){ret[decodeURIComponent(a)]=decodeURIComponent(b)})}return ret}});var MatcherFactory=GravityRD.extend(Object,{getInstance:function(config){var type=config.type;if("urlpath-regexp"===type){return new URLPathRegexpMatcher(config)}else{if("url-regexp"===type){return new URLRegexpMatcher(config)}else{if("urlquery-regexp"===type){return new URLQueryRegexpMatcher(config)}else{if("host-regexp"===type){return new HostRegexpMatcher(config)}else{if("cookie-regexp"===type){return new CookieRegexpMatcher(config)}else{if("referrer-regexp"===type){return new ReferrerRegexpMatcher(config)}else{if("selector"===type){return new SelectorMatcher(config)}else{if("meta-tag"===type){return new MetaTagMatcher(config)}else{if("meta-data"===type){return new MetaDataMatcher(config)}else{if("jsvar"===type){return new JSVarMatcher(config)}else{if("utm"===type){return new UTMMatcher(config)}else{if("dataLayer"===type){return new DataLayerMatcher(config)}else{GravityRD.Log.error("Unknown matcher type '"+type+"', please check your configuration");return null}}}}}}}}}}}}}});var AbstractSplitter=GravityRD.extend(Object,{config:null,constructor:function(c){this.config=c}});var splitCookieCache={};var ProportionalSplitter=GravityRD.extend(AbstractSplitter,{split:function(pageName,page){var groupName=(page.splitConfig.group||pageName);var cookieName="gr_split_"+groupName;var cookieVersionName="gr_splitv_"+groupName;var splitCookieVersion=parseInt(GravityRD.Core.Cookie.getCookie(cookieVersionName))||0;var expectedCookieVersion=parseInt(page.splitConfig.version)||0;if(expectedCookieVersion>splitCookieVersion){GravityRD.Log.debug("Expected cookie version ["+expectedCookieVersion+"] > currentCookieVersion ["+splitCookieVersion+"]. Removing old cookie.");GravityRD.Core.Cookie.setCookie(cookieName,"",0)}var splitValue=splitCookieCache[cookieName]||GravityRD.Core.Cookie.getCookie(cookieName);GravityRD.Log.debug("Split cookie found for page '"+pageName+"': '"+splitValue+"'");for(var i=0;i<page.splitConfig.names.length;i++){if(page.splitConfig.names[i]===splitValue){return{name:splitValue,version:expectedCookieVersion,created:false}}}var s=0,sold=0,splitIndex=-1;for(i=0;i<page.splitConfig.policy.values.length;i++){s+=page.splitConfig.policy.values[i]}var mod=(parseInt(Math.random()*1000000)%s);GravityRD.Log.debug("Split value is invalid.",mod);for(i=0,s=0;i<page.splitConfig.policy.values.length;i++){s+=page.splitConfig.policy.values[i];if(mod<s&&mod>=sold){splitIndex=i;break}sold=s}if(splitIndex!=-1){splitCookieCache[cookieName]=page.splitConfig.names[splitIndex];GravityRD.Core.Cookie.setCookie(cookieName,page.splitConfig.names[splitIndex]);if(expectedCookieVersion>0){GravityRD.Core.Cookie.setCookie(cookieVersionName,expectedCookieVersion)}return{name:page.splitConfig.names[splitIndex],version:expectedCookieVersion,created:true}}}});var FromCookieSplitter=GravityRD.extend(AbstractSplitter,{split:function(pageName,page){var cookieName=page.splitConfig.policy.cookieName;var splitValue=GravityRD.Core.Cookie.getCookie(cookieName);var n=page.splitConfig.names;GravityRD.Log.debug("Split cookie found for page '"+pageName+"': '"+splitValue+"'");var cv=page.splitConfig.policy.cookieValues;if(GravityRD.isArray(cv)){if(cv.length===n.length){for(var i=0;i<n.length;i++){var cr=new RegExp(cv[i]);if(!!cr.exec(splitValue)){return{name:n[i],version:0}}}}else{GravityRD.Log.error("Length of cookieValues is wrong, should be "+n.length)}}else{GravityRD.Log.error("Only array type is supported currently for cookieValues")}GravityRD.Log.debug("Split value is invalid.",splitValue);var f=page.splitConfig.policy.fallbackSplit;if(!GravityRD.isUndefined(f)){return{name:f,version:0}}return null}});var SplitterFactory=GravityRD.extend(Object,{getInstance:function(config){var type=config.policy.type;if("proportional"===type){return new ProportionalSplitter(config)}else{if("from-cookie"===type){return new FromCookieSplitter(config)}else{GravityRD.Log.error("Unknown splitter type '"+type+"', please check your configuration");return null}}}});var GravityRD_CustomConfig=GravityRD.Base.extend({__public__:["init","set","enable","applyCss","addEventListener","getDomEngine","domready","updateCart"],matcherFactory:new MatcherFactory(),splitterFactory:new SplitterFactory(),config:null,initialized:false,enabled:false,domengine:null,domreadyfunctions:[],domreadydone:false,enable:function(){this.enabled=true},set:function(config,environment,xinit){this.config=config;this.environment=environment;if(!!xinit){this.init()}},updateCart:function(ncart){var tr=GravityRD.Core.Cookie.getTracking();var cartObj=tr.cart;var ocart=cartObj.getItems();var nkeys=GravityRD.keys(ncart);var okeys=GravityRD.keys(ocart);for(var i=0;i<nkeys.length;i++){var vo=ocart[nkeys[i]]||0;var vn=ncart[nkeys[i]]||0;if(vn==0||vn<vo){cartObj.removeItem(nkeys[i],vo-vn);_gravity.push({type:"event",eventType:"REMOVE_FROM_CART",newQuantity:""+vn,itemId:""+nkeys[i]})}else{if(vn>vo){cartObj.addItem(nkeys[i],vn-vo);_gravity.push({type:"event",eventType:"ADD_TO_CART",newQuantity:""+vn,itemId:""+nkeys[i]})}}}for(i=0;i<okeys.length;i++){if(ncart[okeys[i]]==undefined){cartObj.removeItem(okeys[i]);_gravity.push({type:"event",eventType:"REMOVE_FROM_CART",newQuantity:"0",itemId:""+okeys[i]})}}},domready:function(fns,immediate){if(!!immediate){GravityRD.each(fns,function(fn){fn.apply(this)},this)}else{GravityRD.each(fns,function(fn){this.domreadyfunctions.push(fn)},this)}},applyCss:function(css){var st=this.styleTag=document.createElement("style");st.type="text/css";st.media="screen, projection";document.getElementsByTagName("head")[0].appendChild(st);var cssx="";GravityRD.each(css,function(line){cssx+=line+"\n"});if(st.styleSheet){st.styleSheet.cssText+="\n"+cssx}else{st.appendChild(document.createTextNode(cssx))}},getSelectorEngine:function(){this.selectorEngine=this.selectorEngine||(function(){if(privatescope.qwery){return function(selector){return privatescope.qwery(selector)}}else{throw"no css selector engine found"}})();return this.selectorEngine},getDomEngine:function(){this.domengine=this.domengine||(function(){if(!!privatescope.bonzo&&!!privatescope.qwery){privatescope.bonzo.setQueryEngine(privatescope.qwery);return function(selector){return privatescope.bonzo(privatescope.qwery(selector))}}else{throw"No dom enigne found."}})();return this.domengine},init:function(runJustDemo){if(!this.domreadydone){GravityRD.each(this.domreadyfunctions,function(fn){fn.call(this)},this);this.domreadydone=true}if(runJustDemo===true){if(this.enabled===true){GravityRD.Log.debug("CustomConfig [demo] enabled by default");return}if(this.initialized===true){GravityRD.Log.debug("CustomConfig [demo] already initialized");return}this.initialized=true}GravityRD.Log.debug("CustomConfig initialization, demo: "+this.demoMode,this.config);if(this.config==null){return}if("test"==this.environment&&GravityRD.RL!==undefined){GravityRD.RL.start()}if(this.config.routing!=null){GravityRD.Core.Request.setupRouting(this.config.routing)}this.pageName=this.identifyPage();GravityRD.Log.debug("Page identification: '"+this.pageName+"'");if(this.pageName==null){return}GravityRD.Core.setGlobalNameValue("_Page",this.pageName);var config=this.initSplit(this.pageName,this.config.pages[this.pageName],runJustDemo);GravityRD.Log.group("Split",true);var pages=this.config.pages||{};var pageOrder=this.calcPageOrder(pages);for(var j=0;j<pageOrder.length;j++){var xpageName=pageOrder[j];var page=this.config.pages[xpageName];if(page.splitConfig!==undefined){var splitter=this.splitterFactory.getInstance(page.splitConfig);var splitInfo=splitter.split(xpageName,page);GravityRD.Core.setGlobalNameValue("_Split"+(page.splitConfig.group||xpageName),splitInfo.name);if(splitInfo.version>0){GravityRD.Core.setGlobalNameValue("_SplitV"+(page.splitConfig.group||xpageName),splitInfo.version)}this.propagateThirdParty(page.splitConfig,splitInfo)}}GravityRD.Log.groupEnd();if(!runJustDemo&&(this.pageName!=null&&(GravityRD.Core.debug("tracking")||GravityRD.Core.debug("postrender")))){document.title="[["+this.pageName+(config.splitName!=null?"/"+config.splitName:"")+"]] "+document.title}GravityRD.Log.debug("Custom configuration for split "+config.splitName+":",config);GravityRD.each(config.register,function(conf){var matcher=this.matcherFactory.getInstance(conf);matcher.register()},this);var css="";GravityRD.each(config.applyCss,function(val){css+=val+"\n"});if(css!=""){GravityRD.CustomConfig.applyCss(css)}GravityRD.Log.debug("Executing postRenderCommands");GravityRD.each(config.postRenderCommands,function(val){try{eval(val)}catch(e){GravityRD.Log.error("Exception while executing postRenderCommands",e)}},this);GravityRD.Log.debug("Executing postRenderFunctions");GravityRD.each(config.postRenderFunction,function(val){try{val.call(this,this.getDomEngine())}catch(e){GravityRD.Log.error("Exception while executing postRenderFunctions",e)}},this);GravityRD.Log.debug("Install tracking");GravityRD.each(config.tracking,function(val){this.installTracking(this.pageName,val)},this);GravityRD.Log.debug("Install hooks");GravityRD.each(config.hooks,function(val){this.installHooks(val)},this)},calcPageOrder:function(pages){var pageOrderConfig=this.config.pageOrder||[];var pageDisableConfig=this.config.pageDisable||[];var pageNames={};var pageOrder=[];for(var pageName in pages){if(!pages.hasOwnProperty(pageName)){continue}if(GravityRD.isString(pageName)){pageNames[pageName]=!0}}for(var i=0;i<pageDisableConfig.length;i++){delete pageNames[pageDisableConfig[i]]}for(i=0;i<pageOrderConfig.length;i++){if(pageNames[pageOrderConfig[i]]){delete pageNames[pageOrderConfig[i]];pageOrder.push(pageOrderConfig[i])}}for(pageName in pageNames){if(!pages.hasOwnProperty(pageName)){continue}if(GravityRD.isString(pageName)){pageOrder.push(pageName)}}return pageOrder},identifyPage:function(){var D=GravityRD.Core.debug("page");D&&GravityRD.Log.group("Pages identification",true);var pages=this.config.pages||{};var pageOrder=this.calcPageOrder(pages);for(var j=0;j<pageOrder.length;j++){var pageName=pageOrder[j];D&&GravityRD.Log.group(pageName);var page=this.config.pages[pageName];var matchType=page.matchType||"all";var matcher;var matched=matchType==="all";if(GravityRD.isArray(page.match)){for(var i=0;i<page.match.length;i++){matcher=this.matcherFactory.getInstance(page.match[i]);var t=page.match[i].type;var m=matcher.match();if(m&&matchType=="any"){matched=true;D&&GravityRD.Log.debug(t+" matched(*): TRUE",page.match[i]);break}else{if(!m&&matchType=="all"){matched=false;D&&GravityRD.Log.debug(t+" matched(*): FALSE",page.match[i]);break}}D&&GravityRD.Log.debug(t+" matched: "+(!!m?"TRUE":"FALSE"),page.match[i])}}else{matcher=this.matcherFactory.getInstance(page.match);matched=matcher.match();D&&GravityRD.Log.debug(page.match.type+" didn't match ",page.match)}D&&GravityRD.Log.groupEnd();if(matched){D&&GravityRD.Log.groupEnd();GravityRD.each(page.match,function(conf){var matcher=this.matcherFactory.getInstance(conf);matcher.register()},this);return pageName}}D&&GravityRD.Log.groupEnd();return null},initSplit:function(pageName,page,runJustDemo){var splitName=null;if(page.splitConfig!==undefined){var splitter=this.splitterFactory.getInstance(page.splitConfig);var splitInfo=splitter.split(pageName,page);this.propagateThirdParty(page.splitConfig,splitInfo);splitName=splitInfo.name}return this.getSplitConfig(page,splitName,runJustDemo)},propagateThirdParty:function(splitConfig,splitInfo){if(splitInfo.created||false){GravityRD.Log.debug("Propagating 3rdparty split information",splitInfo);var thirdParty=splitConfig.thirdparty||{};if(thirdParty.store||false){var ep=GravityRD.Core.Request.getEndpoint(true,"AdServlet");GravityRD.Core.Request.scriptTagRequest(ep,"action=setparam&name="+(thirdParty.name||"_Split")+"&value="+encodeURIComponent(splitInfo.name))}}},getSplitConfig:function(page,splitName,runJustDemo){var config={};var i;if(splitName!=null){var split=(page.splits||{})[splitName]||{};var demo=split.__demo||{};var base=runJustDemo===true?demo:split;if(this.enabled){base=this.applyArray(base,demo,["__demo"])}config=this.applyArray(config,base,["templates","__demo"]);var templates=base.templates||[];for(i=0;i<templates.length;i++){config=this.applyArray(config,this.config.templates[templates[i]])}}var pageDemo=page.__demo||{};var pageBase=runJustDemo===true?pageDemo:page;if(this.enabled){pageBase=this.applyArray(pageBase,pageDemo,["splits","splitConfig","match","__demo"])}config=this.applyArray(config,pageBase,["splits","splitConfig","match","__demo"]);for(i=0;i<(pageBase.templates||[]).length;i++){config=this.applyArray(config,this.config.templates[pageBase.templates[i]])}config.splitName=splitName;return config},applyArray:function(target,source,prohibit){for(var k in source){if(!source.hasOwnProperty(k)){continue}var prohibited=false;if(prohibit!=undefined){for(var j=0;j<prohibit.length;j++){if(prohibit[j]==k){prohibited=true;break}}}if(!prohibited){if(!GravityRD.isArray(target[k])){var item=target[k];target[k]=[];if(item!=undefined){target[k].push(item)}target[k]=target[k]||[]}if(GravityRD.isArray(source[k])){target[k]=target[k].concat(source[k])}else{target[k].push(source[k])}}}return target},addEventListener:function(element,type,callback){if(element.addEventListener){element.addEventListener(type,callback,false)}else{element.attachEvent("on"+type,callback)}},installHooks:function(conf,debug,time){time=time||0;var $S=this.getSelectorEngine();var nl=(GravityRD.isFunction(conf.selector))?conf.selector.call(this,$S):$S(conf.selector);if(nl.length!==0){this.installHook(conf,debug,nl)}if(nl.length===0||conf.destroyOnFound===false){var d,m,p;if(conf.poll===true){d=conf.period===undefined||conf.period===null?250:conf.period;m=conf.until===undefined||conf.until===null?10000:conf.until;p=true}if(GravityRD.isArray(d)&&this.count===undefined){this.count=0}if(p&&(time<m)){if(GravityRD.isArray(d)&&this.count>=d.length){return}window.setTimeout(GravityRD.bind(function(){var ttime=time+GravityRD.isArray(d)?d[this.count]:d;this.installHooks(conf,debug,ttime)},this),GravityRD.isArray(d)?d[this.count++]:d)}}},installHook:function(conf,debug,nl){var on=conf.on||"click";var color=Math.round(Math.random()*256)+","+Math.round(Math.random()*256)+","+Math.round(Math.random()*256);GravityRD.each(nl,function(element){if(on==="init"){conf.callback.call(this,this.getDomEngine(),conf)}else{this.addEventListener(element,on,conf.callback);if(GravityRD.Core.debug(debug||"tracking")){element.setAttribute("style","background-color:rgb("+color+");")}}},this)},installTracking:function(pageName,conf){conf.callback=function(){_gravity.push({type:"event",eventType:"TRACK",pageName:pageName,boxName:conf.name})};this.installHooks(conf)}});GravityRD.register("GravityRD","CustomConfig",new GravityRD_CustomConfig())})();GravityRD.init({partnerId:"vietnamworks",debug:true,mode:"PROD",customConfig:"demo"},"68b3a1e");(function(){var customConfig=customConfig||{pages:{},templates:{}};var splitConfig={names:["A","B"],policy:{type:"proportional",values:[100,0]},group:"GLOBAL",version:1};var MATCH_MAIN_PAGE={type:"urlpath-regexp",pattern:"^/$"};var VIETNAMWORKS_MATCH={type:"host-regexp",pattern:".*www\\.vietnamworks\\.com"};var VIETNAMWORKS_STAGING_MATCH={type:"host-regexp",pattern:".*staging\\.vietnamworks\\.com"};customConfig.pages.VIETNAMWORKS_ITEM_PAGE={match:[VIETNAMWORKS_MATCH,{type:"selector",selector:"input#jobId"}],splitConfig:splitConfig,postRenderFunction:function($){var date=new Date();date.setTime(date.getTime()+(365*24*60*60*1000));document.cookie="gr_split_GLOBAL=A; expires="+date.toGMTString()+"; path=/";var userDiv=document.getElementById("gravity_userId");if(userDiv!==null&&userDiv!==undefined){var userId=userDiv.getAttribute("data-userid");if(userId!==null&&userId!=undefined&&userId!=""){GravityRD.Core.setGlobalNameValue("userId",userId)}}var itemId=document.getElementById("jobId").getAttribute("value");var send_view={type:"event",eventType:"VIEW",itemId:itemId};send_view.environment="production";_gravity.push(send_view)},hooks:[{selector:"button.btn.btn-primary.btn-xlg.col-sm-12",on:"click",callback:function(){var itemId=document.getElementById("jobId").getAttribute("value");if(itemId!==null&&itemId!==undefined){var apply={type:"event",eventType:"APPLY",itemId:itemId};apply.environment="production";_gravity.push(apply)}}},{selector:"button.btn.btn-sm.btn-google.btn-block.push-top-xs",on:"click",callback:function(){var itemId=document.getElementById("jobId").getAttribute("value");if(itemId!==null&&itemId!==undefined){var apply={type:"event",eventType:"APPLY",itemId:itemId};apply.environment="production";_gravity.push(apply)}}},{selector:"button.btn.btn-primary.btn-md.btn-block",on:"click",callback:function(){var itemId=document.getElementById("jobId").getAttribute("value");if(itemId!==null&&itemId!==undefined){var apply={type:"event",eventType:"APPLY",itemId:itemId};apply.environment="production";_gravity.push(apply)}}},{selector:"button.btn.push-top-xs.btn-block.btn-md.btn-default.save-job-button",on:"click",callback:function(){var itemId=document.getElementById("jobId").getAttribute("value");if(itemId!==null&&itemId!==undefined){var wish={type:"event",eventType:"ADD_TO_WISHLIST",itemId:itemId};wish.environment="production";_gravity.push(wish)}}}]};customConfig.pages.VIETNAMWORKS_ITEM_PAGE_STAGING={match:[VIETNAMWORKS_STAGING_MATCH,{type:"selector",selector:"input#jobId"}],splitConfig:splitConfig,postRenderFunction:function($){var date=new Date();date.setTime(date.getTime()+(365*24*60*60*1000));document.cookie="gr_split_GLOBAL=A; expires="+date.toGMTString()+"; path=/";var userDiv=document.getElementById("gravity_userId");if(userDiv!==null&&userDiv!==undefined){var userId=userDiv.getAttribute("data-userid");if(userId!==null&&userId!=undefined&&userId!=""){GravityRD.Core.setGlobalNameValue("userId","stage_"+userId)}}var itemId=document.getElementById("jobId").getAttribute("value");var send_view={type:"event",eventType:"VIEW",itemId:"stage_"+itemId};send_view.environment="staging";_gravity.push(send_view)},hooks:[{selector:"button.btn.btn-primary.btn-xlg.col-sm-12",on:"click",callback:function(){var itemId=document.getElementById("jobId").getAttribute("value");var userId=document.getElementById("gravity_userId").getAttribute("data-userid");if(itemId!==null&&itemId!==undefined){var apply={type:"event",eventType:"APPLY",itemId:"stage_"+itemId};apply.environment="staging";_gravity.push(apply)}}},{selector:"button.btn.push-top-xs.btn-block.btn-md.btn-default.save-job-button",on:"click",callback:function(){var itemId=document.getElementById("jobId").getAttribute("value");if(itemId!==null&&itemId!==undefined){var wish={type:"event",eventType:"ADD_TO_WISHLIST",itemId:"stage_"+itemId};wish.environment="staging";_gravity.push(wish)}}},{selector:"button.btn.btn-sm.btn-google.btn-block.push-top-xs",on:"click",callback:function(){var itemId=document.getElementById("jobId").getAttribute("value");if(itemId!==null&&itemId!==undefined){var apply={type:"event",eventType:"APPLY",itemId:"stage_"+itemId};apply.environment="staging";_gravity.push(apply)}}}]};customConfig.pages.VIETNAMWORKS_APPLY_ALL_PAGE={match:[VIETNAMWORKS_MATCH,{type:"selector",selector:"table.table.selected-job-table.hidden-xs"}],splitConfig:splitConfig,postRenderFunction:function($){var date=new Date();date.setTime(date.getTime()+(365*24*60*60*1000));document.cookie="gr_split_GLOBAL=A; expires="+date.toGMTString()+"; path=/";var userDiv=document.getElementById("gravity_userId");if(userDiv!==null&&userDiv!==undefined){var userId=userDiv.getAttribute("data-userid");if(userId!==null&&userId!=undefined&&userId!=""){GravityRD.Core.setGlobalNameValue("userId",userId)}}},hooks:[{selector:"a.btn-primary.btn.btn-sm.btn-apply-job",on:"click",callback:function(){var items=document.querySelectorAll(".animated.fadeInLeft i");for(var i=0;i<items.length;i++){var itemId=items[i].getAttribute("data-jobid");if(itemId!==null&&itemId!==undefined&&itemId!==""){var apply={type:"event",eventType:"APPLY",itemId:itemId};apply.environment="production";_gravity.push(apply)}}}}]};customConfig.pages.VIETNAMWORKS_APPLY_ALL_PAGE_STAGING={match:[VIETNAMWORKS_STAGING_MATCH,{type:"selector",selector:"table.table.selected-job-table.hidden-xs"}],splitConfig:splitConfig,postRenderFunction:function($){var date=new Date();date.setTime(date.getTime()+(365*24*60*60*1000));document.cookie="gr_split_GLOBAL=A; expires="+date.toGMTString()+"; path=/";var userDiv=document.getElementById("gravity_userId");if(userDiv!==null&&userDiv!==undefined){var userId=userDiv.getAttribute("data-userid");if(userId!==null&&userId!=undefined&&userId!=""){GravityRD.Core.setGlobalNameValue("userId","stage_"+userId)}}},hooks:[{selector:"a.btn-primary.btn.btn-sm.btn-apply-job",on:"click",callback:function(){var items=document.querySelectorAll(".animated.fadeInLeft i");for(var i=0;i<items.length;i++){var itemId=items[i].getAttribute("data-jobid");if(itemId!==null&&itemId!==undefined&&itemId!==""){var apply={type:"event",eventType:"APPLY",itemId:"stage_"+itemId};apply.environment="staging";_gravity.push(apply)}}}}]};customConfig.pages.VIETNAMWORKS_OTHER={match:[VIETNAMWORKS_MATCH],splitConfig:splitConfig,postRenderFunction:function($){var date=new Date();date.setTime(date.getTime()+(365*24*60*60*1000));document.cookie="gr_split_GLOBAL=A; expires="+date.toGMTString()+"; path=/";var userDiv=document.getElementById("gravity_userId");if(userDiv!==null&&userDiv!==undefined){var userId=userDiv.getAttribute("data-userid");if(userId!==null&&userId!=undefined&&userId!=""){GravityRD.Core.setGlobalNameValue("userId",userId)}}},hooks:[{selector:"a#grv-apply-all",on:"click",callback:function(){var items=document.getElementById("grv-apply-all").getAttribute("href");var items1=items.split("apply-multiple-jobs/");var items2=items1[1].split("_");for(var i=0;i<items2.length;i++){var itemId=items2[i];if(itemId!==null&&itemId!==undefined&&itemId!==""){var apply={type:"event",eventType:"APPLY",itemId:itemId};apply.environment="production";_gravity.push(apply)}}}}]};customConfig.pageOrder=["VIETNAMWORKS_ITEM_PAGE","VIETNAMWORKS_APPLY_ALL_PAGE","VIETNAMWORKS_ITEM_PAGE_STAGING","VIETNAMWORKS_APPLY_ALL_PAGE_STAGING","VIETNAMWORKS_OTHER"];GravityRD.CustomConfig.set(customConfig)}());domready(function(){GravityRD.start()})})();